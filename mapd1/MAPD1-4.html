<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bomba-Relógio — UNIPE</title>
<style>
  :root{
    --bg:#0b0f16; --accent:#ff3b3b; --accent2:#19d17f; --text:#e6eefc; --muted:#8ea2c0; --warn:#ffb020; --glass:#0b1422c0;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background:
      radial-gradient(1200px 800px at 70% -10%, #1a2235, var(--bg)),
      radial-gradient(600px 400px at 20% 120%, #0c1220 10%, transparent 60%) no-repeat;
    color:var(--text);
    font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial;
    user-select:none; -webkit-user-select:none; -ms-user-select:none;
    overflow:hidden;
  }
  .wrap{max-width:1100px;margin:0 auto;padding:24px;height:100%;
        display:grid;grid-template-rows:auto 1fr auto;gap:16px}

  /* Header / Footer */
  header, footer{
    position:relative; border-radius:16px; padding:12px 16px;
    display:flex; align-items:center; justify-content:space-between; gap:16px;
    border:1px solid rgba(255,255,255,.10);
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    backdrop-filter: blur(6px);
  }
  .title{display:flex; gap:12px; align-items:center; font-weight:800; letter-spacing:.4px}
  .led{width:12px;height:12px;border-radius:50%;
    background: radial-gradient(circle at 30% 30%, #ffa0a0, var(--accent));
    box-shadow: 0 0 16px var(--accent), 0 0 32px rgba(255,59,59,.5);
    animation: blink 1s infinite;
  }
  @keyframes blink{0%,65%{opacity:1}66%,100%{opacity:.35}}
  .status-line{display:flex; gap:14px; align-items:center; color:var(--muted); font-size:14px}
  .pill{padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04)}
  .progress{height:10px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden;border:1px solid rgba(255,255,255,.1)}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent2),#22b3ff);transition:width .25s}

  /* Main layout: Timer • Perguntas */
  .main{
    position:relative; overflow:auto;
    border-radius:22px; padding:clamp(16px,3vw,28px);
    display:grid; grid-template-columns: 360px 1fr; gap:24px;
    background:
      radial-gradient(800px 600px at 80% -30%, rgba(255,255,255,.06), transparent 40%),
      linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
    border:1px solid rgba(255,255,255,.10);
    max-height: calc(100vh - 160px);
  }
  @media (max-width: 900px){ .main{ grid-template-columns: 1fr; } }

  /* TIMER (anel hi-tech) */
  .timerBox{
    position:relative; border-radius:18px; padding:18px; display:grid; gap:16px;
    border:1px solid rgba(255,255,255,.12);
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    align-content:start;
  }
  .dial{
    position:relative; width:100%; aspect-ratio:1/1; border-radius:50%;
    background:
      conic-gradient(var(--accent2) calc(var(--p,100)*1%), rgba(255,255,255,.10) 0),
      radial-gradient(circle at 50% 50%, rgba(255,255,255,.15), rgba(0,0,0,.65) 70%, transparent 72%);
    box-shadow: inset 0 0 50px rgba(0,0,0,.6), 0 14px 40px rgba(0,0,0,.4), inset 0 0 2px rgba(255,255,255,.25);
  }
  .dial::before{
    content:""; position:absolute; inset:22px; border-radius:50%;
    background: conic-gradient(from 0deg, #9aa2ad, #d7dde6, #6f7784, #9aa2ad, #d7dde6, #6f7784, #9aa2ad);
    box-shadow: inset 0 2px 6px rgba(255,255,255,.35), inset 0 -2px 10px rgba(0,0,0,.6);
    filter: saturate(120%);
  }
  .glass{
    position:absolute; inset:64px; border-radius:16px;
    background:
      radial-gradient(200px 100px at 30% 0%, rgba(255,255,255,.18), transparent 60%),
      linear-gradient(180deg, var(--glass), rgba(4,8,14,.82));
    border:1px solid rgba(255,255,255,.15);
    display:grid; place-items:center;
  }
  .digits{
    font-family: "Segoe UI","Consolas",monospace;
    font-weight:900; font-size: clamp(36px, 6vw, 56px); letter-spacing:.08em; color:#bfffe0;
    text-shadow: 0 0 10px rgba(25,209,127,.7), 0 0 22px rgba(34,179,255,.3), 0 0 46px rgba(25,209,127,.45);
  }
  .warnGlow{ box-shadow: 0 0 0 3px rgba(255,176,32,.25), inset 0 0 16px rgba(255,176,32,.25) !important; }

  /* Perguntas */
  .qbox{
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    border:1px solid rgba(255,255,255,.10); border-radius:18px; padding:18px;
    display:grid; gap:12px; align-content:start;
  }
  .qhead{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
  .question{ font-size: clamp(18px,2.2vw,24px); line-height:1.35; font-weight:800; flex:1; }
  .options{ display:grid; grid-template-columns:1fr; gap:12px; margin-top:6px }
  .btn{
    --bg:#151d2a;
    border:1px solid rgba(255,255,255,.12);
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.01)), var(--bg);
    padding:14px 16px; border-radius:12px; color:var(--text); text-align:left; cursor:pointer;
    transition: transform .08s, border-color .12s, box-shadow .12s, background .12s;
    font-weight:700; box-shadow: 0 3px 10px rgba(0,0,0,.25);
  }
  .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.25) }
  .btn.correct{ background: linear-gradient(180deg, rgba(25,209,127,.18), rgba(25,209,127,.06)); border-color: rgba(25,209,127,.55) }
  .btn.wrong{   background: linear-gradient(180deg, rgba(255,59,59,.18), rgba(255,59,59,.06));   border-color: rgba(255,59,59,.55) }
  .feedback{min-height:40px; font-size:14px; color:var(--muted); line-height:1.35}
  .feedback.good{color:var(--accent2)} .feedback.bad{color:var(--accent)} .feedback.warn{color:var(--warn)}

  /* Cards e cenas com imagem à direita e balão à esquerda */
  .card{background:#111924; border:1px solid rgba(255,255,255,.12); border-radius:18px; padding:24px; max-width:960px; margin:0 auto; box-shadow:0 14px 40px rgba(0,0,0,.45)}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .primary{background:var(--accent2); color:#062a1c; border:none; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:900}
  .ghost{background:transparent; color:#fff; border:1px solid rgba(255,255,255,.2); padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:800}

  .sceneGrid{ display:grid; grid-template-columns: minmax(260px, 1fr) minmax(260px, 42vw); gap:16px; align-items:center }
  .leftCol{ display:flex; flex-direction:column; gap:12px; align-items:flex-start }
  .sceneImg{ width: min(520px, 42vw); height:auto; border-radius:16px; border:1px solid rgba(255,255,255,.15); box-shadow:0 20px 60px rgba(0,0,0,.5) }
  @media (max-width: 760px){
    .sceneGrid{ grid-template-columns: 1fr; }
    .sceneImg{ justify-self:center; width:min(420px, 90vw) }
  }

  .bubble{
    background:#ffffff; color:#111; padding:14px 16px; border-radius:12px; font-weight:800;
    filter: drop-shadow(0 6px 18px rgba(0,0,0,.35)); max-width: min(60ch, 80vw);
    position:relative;
  }
  .bubble-left::after{
    content:""; position:absolute; top:50%; left:100%; transform:translateY(-50%);
    width:0; height:0; border-top:12px solid transparent; border-bottom:12px solid transparent; border-right:14px solid #fff;
  }
  .intro-meta{ color:var(--muted); margin-top:4px; font-size:13px }

  /* OVERLAYS de camada */
  .overlay{position:absolute; inset:0; background:rgba(0,0,0,.75); display:none; align-items:center; justify-content:center; text-align:left; padding:24px; z-index:12}

  /* INTRO (cientista1) — overlay fixo por cima de tudo */
  .intro{position:fixed; inset:0; background:rgba(0,0,0,.85); display:flex; align-items:center; justify-content:center; z-index:1000; padding:24px}

  /* Explosão e vilão vencedor */
  .flash{position:fixed; inset:0; background:#fff; z-index:1200; display:none}
  .villainWin{ position:fixed; inset:0; background:rgba(0,0,0,.92); display:none; z-index:1201; align-items:center; justify-content:center; padding:24px }
  .crackimg{
    position:fixed; inset:0; z-index:1202; display:none;
    background: #000 url('tela.jpg') center/cover no-repeat;
    align-items:center; justify-content:center;
  }
  .crackimg::after{
    content:""; position:absolute; inset:0;
    background: radial-gradient(circle at center, rgba(0,0,0,0) 0%, rgba(0,0,0,.35) 55%, rgba(0,0,0,.75) 100%);
    pointer-events:none;
  }
  .crackimg .stack{ position:relative; display:flex; flex-direction:column; align-items:center; gap:14px; z-index:2 }
  .crackimg .boom-title{ color:#f1f1f1; font-size: clamp(28px,6vw,60px); letter-spacing:2px; font-weight:900; margin:0; text-shadow: 0 0 14px rgba(255,255,255,.5), 0 0 30px rgba(255,59,59,.45) }
  .crackimg .restart{
    display:none; background: var(--accent); color:#190202; border:none; padding:12px 18px; border-radius:12px; cursor:pointer; font-weight:900;
    box-shadow: 0 8px 24px rgba(255,59,59,.35);
  }

  .shake{animation:shake .18s ease 0s 2}
  @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
  ::selection{background:transparent}
  button:focus-visible{outline:2px solid #22b3ff; outline-offset:3px}
</style>
</head>
<body>
<div class="wrap" id="app">

  <header>
    <div class="title"><div class="led" id="led"></div><div>Bomba • Protocolo UNIPE</div></div>
    <div class="status-line">
      <div class="pill">Pergunta: <span id="qidx">1</span>/<span id="qtotal">—</span></div>
      <div class="pill">Tentativas: <span id="tries">2</span>/2</div>
      <div class="pill">Progresso
        <div class="progress" style="width:170px;display:inline-block;vertical-align:middle;margin-left:8px">
          <div class="bar" id="bar"></div>
        </div>
      </div>
    </div>
  </header>

  <div class="main" id="main">
    <!-- TIMER -->
    <div class="timerBox">
      <div style="font-weight:800;letter-spacing:.4px;color:var(--muted)">TIMER (50 min)</div>
      <div class="dial" id="dial">
        <div class="glass"><div class="digits" id="digits">50:00</div></div>
      </div>
      <div class="pill" style="justify-self:start">Cronômetro global</div>
    </div>

    <!-- PERGUNTAS -->
    <div class="qbox">
      <div class="qhead">
        <div class="question" id="question">Aguarde…</div>
      </div>
      <div class="options" id="options"></div>
      <div class="feedback" id="feedback">&nbsp;</div>
    </div>

    <!-- OVERLAY DE INFORMAÇÕES (após intro) -->
    <div class="overlay" id="entryOverlay" role="dialog" aria-modal="true" style="grid-column:1/-1">
      <div class="card">
        <h2>Protocolo de Desarmamento</h2>
        <p>Você terá <strong id="qcount1">—</strong> questões. Avança só quando <strong>acertar</strong>. Dois erros na mesma pergunta = <strong>BOOM</strong>. Tempo total: <strong>50 minutos</strong>.</p>
        <p class="intro-meta">Texto não selecionável • Atalhos/Print bloqueados (melhor esforço)</p>
      </div>
    </div>

    <!-- SUCESSO (cientista2 preso) -->
    <div class="overlay" id="defused" style="z-index:20">
      <div class="card">
        <div class="sceneGrid">
          <div class="leftCol">
            <div class="bubble bubble-left"><strong>Missão cumprida!</strong><br/>A turma do UNIPE desarmou a bomba a tempo. Suspeito rendido e sob custódia.</div>
            <div class="row" style="margin-top:6px"><button class="primary" id="againBtn">Jogar de novo</button></div>
          </div>
          <img class="sceneImg" src="cientista2.jpg" alt="Cientista detido">
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div style="color:var(--muted);font-size:13px">Timer + perguntas • Anti-cola ativo</div>
    <div><button class="ghost" id="fsToggle">Tela cheia (opcional)</button></div>
  </footer>
</div>

<!-- INTRO (cientista1 com fala à esquerda + botões abaixo do balão) -->
<div class="intro" id="intro">
  <div class="card">
    <div class="sceneGrid">
      <div class="leftCol">
        <div class="bubble bubble-left">
          Estudantes de Medicina do UNIPE…<br/>
          <strong>Provem que merecem o jaleco!</strong><br/>
          Desarmem minha bomba respondendo <strong id="qcount2">—</strong> questões antes do tempo acabar.
        </div>
        <div class="row">
          <button class="primary" id="introStartBtn">Iniciar</button>
          <a class="ghost" href="Apostila%20de%20Imunidade%20Inata.pdf" download>Baixar apostila (PDF)</a>
        </div>
        <div class="intro-meta">Clique em <em>Iniciar</em> para ver os informes e começar a missão.</div>
      </div>
      <img class="sceneImg" src="cientista1.jpg" alt="Cientista desafiando os estudantes">
    </div>
  </div>
</div>

<!-- EXPLOSÃO: Flash, vilão comemorando (cientista3), rachadura e reinício (com atraso de 5s após o vilão aparecer) -->
<div class="flash" id="flash"></div>

<div class="villainWin" id="villainWin">
  <div class="card">
    <div class="sceneGrid">
      <div class="leftCol">
        <div class="bubble bubble-left"><strong>Ha!</strong> Vocês falharam, UNIPE!<br/>A ciência sem atenção <em>explode</em> no final…</div>
      </div>
      <img class="sceneImg" src="cientista3.jpg" alt="Cientista comemorando a vitória">
    </div>
  </div>
</div>

<div class="crackimg" id="crackimg">
  <div class="stack">
    <h1 class="boom-title">BOOM</h1>
    <button class="restart" id="restartBtn">Reiniciar</button>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const CONFIG = { requireFullscreen:false, explodeOnBlur:false, strictShortcuts:true };

/* ===== PERGUNTAS (sem marcas de citação) ===== */
const QUESTIONS = [
  { q:`1. Qual é a função fisiológica primária e benéfica do sistema imune?`,
    options:[`(A) Manter a homeostase da temperatura corporal através da febre.`,`(B) Defender o organismo contra microrganismos infecciosos e eliminar substâncias estranhas.`,`(C) Regular o crescimento e a diferenciação de todos os tecidos do corpo.`,`(D) Exclusivamente reparar tecidos danificados após uma lesão.`],
    a:1,
    why:[`**(A) Incorreta.** Febre é consequência sistêmica, não a função primária.`,
         `**(B) Correta.** A função central é defesa contra patógenos; eliminar estranhos é correlato.`,
         `**(C) Incorreta.** Influência de citocinas ≠ função primária do SI.`,
         `**(D) Incorreta.** Reparo decorre da inflamação; primeiro é a defesa.`] },
  { q:`2. A existência de alergias e lúpus mostra que:`,
    options:[`(A) O sistema imune torna-se inerentemente patológico.`,`(B) Mecanismos protetores, desregulados/mal direcionados, podem causar doença.`,`(C) Adaptativa é sempre prejudicial e inata sempre protetora.`,`(D) Patógenos reprogramam permanentemente o SI para autoagressão.`],
    a:1, why:[`**(A) Incorreta.** O problema é regulação/alvo, não potência.`,
                `**(B) Correta.** Mesmo mecanismo, alvo errado ou excesso = patologia.`,
                `**(C) Incorreta.** Ambas podem causar doença quando desreguladas.`,
                `**(D) Incorreta.** Gatilhos existem, mas o núcleo é falha de autotolerância.`] },
  { q:`3. Nas primeiras horas após a entrada do patógeno, quem inicia a defesa?`,
    options:[`(A) Adaptativa com anticorpos rápidos.`,`(B) Inata com mecanismos pré-existentes.`,`(C) Ambos ao mesmo tempo e velocidade.`,`(D) Humoral isolado via complemento instantâneo.`],
    a:1, why:[`**(A) Incorreta.** Adaptativa leva dias.`,
              `**(B) Correta.** Inata responde em horas porque já está pronta.`,
              `**(C) Incorreta.** Inata precede adaptativa.`,
              `**(D) Incorreta.** Complemento não é instantâneo nem único componente.`] },
  { q:`4. Diferença central de reconhecimento entre inata e adaptativa:`,
    options:[`(A) Inata detecta PAMPs; adaptativa reconhece antígenos específicos.`,`(B) Inata usa MHC; adaptativa usa TLRs.`,`(C) Inata só bactérias; adaptativa vírus/fungos.`,`(D) Inata apenas por DAMPs; adaptativa por PAMPs.`],
    a:0, why:[`**(A) Correta.** Assinaturas compartilhadas vs. detalhes finos.`,
              `**(B) Incorreta.** MHC é da adaptativa; TLRs são da inata.`,
              `**(C) Incorreta.** Ambos lidam com vários patógenos.`,
              `**(D) Incorreta.** Inata responde a PAMPs e DAMPs; adaptativa por antígenos.`] },
  { q:`5. O que define “memória imunológica”?`,
    options:[`(A) Inata sempre responde mais forte.`,`(B) Adaptativa responde mais rápido e melhor ao mesmo antígeno.`,`(C) Inflamação crônica de baixo grau.`,`(D) Só anticorpos circulantes.`],
    a:1, why:[`**(A) Incorreta.** Inata clássica não tem memória específica.`,
              `**(B) Correta.** B/T memória geram resposta secundária otimizada.`,
              `**(C) Incorreta.** É estado patológico.`,
              `**(D) Incorreta.** Memória celular também é crucial.`] },
  { q:`6. Vantagem de possuir inata e adaptativa:`,
    options:[`(A) São redundantes.`,`(B) Inata contém e instrui; adaptativa erradica.`,`(C) Inata só barreiras; adaptativa órgãos internos.`,`(D) Inata bactérias; adaptativa vírus.`],
    a:1, why:[`**(A) Incorreta.** São complementares.`,
              `**(B) Correta.** Inata sinaliza/molda adaptativa e contém no início.`,
              `**(C) Incorreta.** Ambas atuam em todo o corpo.`,
              `**(D) Incorreta.** Falsa dicotomia.`] },
  { q:`7. Em apendicite aguda, qual célula domina o infiltrado inicial?`,
    options:[`(A) Plasmócitos.`,`(B) Linfócitos T CD4+.`,`(C) Mastócitos.`,`(D) Neutrófilos.`],
    a:3, why:[`**(A) e (B) Incorretas.** Predominam em fases tardias/crônicas.`,
              `**(B) Nota.** T CD4+ orquestram, mas não dominam o início agudo.`,
              `**(C) Incorreta.** Iniciam eventos locais, porém não predominam no infiltrado.`,
              `**(D) Correta.** Marca clássica da inflamação aguda.`] },
  { q:`8. Ponte inata–adaptativa pela célula dendrítica:`,
    options:[`(A) Fagocitar e apresentar via MHC II.`,`(B) Ativar linfócitos T naive (resposta primária).`,`(C) Produzir TNF e IL-1.`,`(D) Reconhecer PAMPs por TLRs.`],
    a:1, why:[`**(A) Incorreta.** Macrófagos e B também apresentam (objetivos diferentes).`,
              `**(B) Correta.** DC ativa T naive com alta eficiência.`,
              `**(C) Incorreta.** Não é exclusivo.`,
              `**(D) Incorreta.** TLRs não são exclusivos.`] },
  { q:`9. Propósito biológico da inflamação:`,
    options:[`(A) Causar dor para alertar.`,`(B) Levar leucócitos e proteínas ao foco para eliminar agente e iniciar reparo.`,`(C) Aumentar temperatura local para destruir patógenos.`,`(D) Formar cicatriz fibrótica para isolar área.`],
    a:1, why:[`**(A) Incorreta.** Dor é sintoma, não propósito.`,
              `**(B) Correta.** Entrega de defesas no local certo.`,
              `**(C) Incorreta.** Calor vem da vasodilatação.`,
              `**(D) Incorreta.** Cicatriz é desfecho possível, não objetivo inicial.`] },
  { q:`10. O que são PAMPs?`,
    options:[`(A) Moléculas únicas por cepa (adaptativa).`,`(B) Toxinas bacterianas letais.`,`(C) Estruturas conservadas de micróbios (ex.: LPS, peptidoglicano) da inata.`,`(D) Moléculas do hospedeiro liberadas no dano.`],
    a:2, why:[`**(A) Incorreta.** Isso descreve antígeno/epítopo.`,
              `**(B) Incorreta.** PAMPs são estruturais, não apenas toxinas.`,
              `**(C) Correta.** Conservação permite reconhecimento amplo com poucos receptores.`,
              `**(D) Incorreta.** Define DAMPs.`] },
  { q:`11. Queimadura solar sem infecção: o que ativa a inata?`,
    options:[`(A) PAMPs liberados pela radiação UV.`,`(B) DAMPs (ATP, DNA) de células danificadas.`,`(C) Autoanticorpos pré-existentes.`,`(D) Complemento ativado diretamente pela luz.`],
    a:1, why:[`**(A) Incorreta.** PAMPs são microbianos.`,
              `**(B) Correta.** Inflamação estéril começa por DAMPs.`,
              `**(C) Incorreta.** Não é o mecanismo aqui.`,
              `**(D) Incorreta.** Luz não ativa diretamente o complemento.`] },
  { q:`12. Citocinas-chave que iniciam/amplificam inflamação aguda no endotélio:`,
    options:[`(A) IL-10 e TGF-β.`,`(B) IFN-γ e IL-4.`,`(C) TNF e IL-1.`,`(D) IL-12 e IL-23.`],
    a:2, why:[`**(A) Incorreta.** Predominantemente regulatórias.`,
              `**(B) Incorreta.** Relacionadas à polarização Th.`,
              `**(C) Correta.** Ativam endotélio e efeitos sistêmicos precocemente.`,
              `**(D) Incorreta.** Mais ligadas à diferenciação T.`] },
  { q:`13. Sequência correta da migração do neutrófilo (sangue → tecido):`,
    options:[`(A) Adesão estável → Rolamento → Transmigração → Quimiotaxia.`,`(B) Rolamento → Integrinas ativadas por quimiocinas → Adesão estável → Transmigração.`,`(C) Quimiotaxia → Transmigração → Rolamento → Adesão estável.`,`(D) Integrinas → Quimiotaxia → Rolamento → Adesão estável.`],
    a:1, why:[`**(A) Incorreta.** Ordem invertida.`,
              `**(B) Correta.** Rolamento → ativação de integrinas → adesão firme → transmigração.`,
              `**(C) Incorreta.** Coloca quimiotaxia antes do extravasamento.`,
              `**(D) Incorreta.** Falta o rolamento antes da adesão firme.`] },
  { q:`14. Principal função do inflamassoma NLRP3:`,
    options:[`(A) Reconhecer PAMPs na superfície e secretar interferons.`,`(B) Ligar-se diretamente a bactérias e ativar complemento.`,`(C) Detectar PAMPs/DAMPs no citosol → ativar Caspase-1 → liberar IL-1β madura.`,`(D) Promover a maturação de linfócitos T no timo.`],
    a:2, why:[`**(A) Incorreta.** Isso é mais TLRs/RLRs; inflamassoma é citosólico.`,
              `**(B) Incorreta.** Descreve vias de MBL/anticorpos.`,
              `**(C) Correta.** Gera IL-1β/IL-18 via Caspase-1.`,
              `**(D) Incorreta.** Timo não envolve inflamassoma.`] }
];

/* ===== PARÂMETROS ===== */
const TOTAL_TIME = 50*60; // 50 minutos
const WARN_THRESHOLD = 60; // destaca quando faltar 1 min

/* ===== ESTADO ===== */
let idx=0, wrong=0, timeLeft=TOTAL_TIME;
let ticking=null, started=false, exploded=false, defused=false;

/* ===== ELEMENTOS ===== */
const qEl=document.getElementById('question');
const optsEl=document.getElementById('options');
const fbEl=document.getElementById('feedback');
const triesEl=document.getElementById('tries');
const qidxEl=document.getElementById('qidx');
const qtotalEl=document.getElementById('qtotal');
const barEl=document.getElementById('bar');

const dialEl=document.getElementById('dial');
const digitsEl=document.getElementById('digits');
const led=document.getElementById('led');

const entryOverlay=document.getElementById('entryOverlay');
const defusedOverlay=document.getElementById('defused');

const intro=document.getElementById('intro');
const introStartBtn=document.getElementById('introStartBtn');

const fsToggle=document.getElementById('fsToggle');

const flashEl=document.getElementById('flash');
const villainWin=document.getElementById('villainWin');
const crackImgEl=document.getElementById('crackimg');
const restartBtn=document.getElementById('restartBtn');
const againBtn=document.getElementById('againBtn');

/* ===== UTILS ===== */
const fmt=(s)=> s.toString().padStart(2,'0');
function setTimer(t){
  const m=Math.floor(t/60), s=t%60, txt=`${fmt(m)}:${fmt(s)}`;
  digitsEl.textContent=txt;
  const pct=Math.max(0,Math.min(100,(t/TOTAL_TIME)*100));
  dialEl.style.setProperty('--p', pct);
  if (t<=WARN_THRESHOLD) dialEl.classList.add('warnGlow'); else dialEl.classList.remove('warnGlow');
}
function setProgress(){
  qidxEl.textContent=(idx+1);
  triesEl.textContent=(2-wrong);
  barEl.style.width=(idx/QUESTIONS.length)*100 + '%';
}
function renderQuestion(){
  const {q, options}=QUESTIONS[idx];
  qEl.textContent=q;
  optsEl.innerHTML='';
  options.forEach((op,i)=>{
    const b=document.createElement('button');
    b.className='btn'; b.textContent=op;
    b.onclick=()=> choose(i,b);
    optsEl.appendChild(b);
  });
  fbEl.innerHTML='Escolha a alternativa correta.';
  fbEl.className='feedback';
  setProgress();
}
function disableOptions(){ [...optsEl.children].forEach(b=>b.disabled=true); }
function enableOptionsExcept(ex){ [...optsEl.children].forEach(b=>{ if(b!==ex) b.disabled=false; }); }

/* ===== LÓGICA ===== */
function choose(i,btn){
  if (exploded||defused) return;
  const correct=QUESTIONS[idx].a;
  disableOptions();

  if (i===correct){
    btn.classList.add('correct');
    fbEl.innerHTML='✔ Resposta correta!'; fbEl.classList.add('good');
    setTimeout(next,420);
  } else {
    wrong++; btn.classList.add('wrong');
    document.getElementById('main').classList.add('shake'); setTimeout(()=>document.getElementById('main').classList.remove('shake'),250);
    const left=2-wrong;

    // justificativa da alternativa clicada (sem revelar a correta)
    const why = QUESTIONS[idx].why?.[i] ?? 'Resposta incorreta.';
    fbEl.innerHTML = why; fbEl.classList.add('bad');

    if (left<=0) explode('Erros máximos nesta pergunta (2).');
    else enableOptionsExcept(btn);
  }
}
function next(){
  idx++; wrong=0;
  if (idx>=QUESTIONS.length) return defuse();
  renderQuestion();
}
function tick(){
  if (exploded||defused) return;
  timeLeft--; setTimer(timeLeft);
  if (timeLeft<=0) explode('Tempo esgotado.');
}
function startGame(){
  if (started) return; started=true;
  entryOverlay.style.display='none';
  setTimer(timeLeft);
  renderQuestion();
  ticking=setInterval(tick,1000);
}

/* ===== Fluxo de telas ===== */
function showEntryThenStart(){
  // mostra informes por ~2,5s e começa
  entryOverlay.style.display='flex';
  setTimeout(startGame, 2500);
}
introStartBtn.onclick = ()=>{
  intro.style.display='none';
  showEntryThenStart();
};

/* ===== EXPLOSÃO ===== */
function explode(_reason){
  if (exploded||defused) return; exploded=true;
  clearInterval(ticking);
  // 1) flash branco (2s)
  flashEl.style.display='block';
  // 2) vilão comemora (imagem à direita) — aparece no t=2s
  setTimeout(()=>{
  flashEl.style.display='none';
  villainWin.style.display='flex';
}, 2000);
  // 3) tela rachada logo depois de 2s de vilão (t=4s)
  setTimeout(()=>{
  villainWin.style.display='none';
  crackImgEl.style.display='flex';
  restartBtn.style.display='inline-block'; // botão já visível
}, 9000);

}

/* ===== SUCESSO ===== */
function defuse(){
  if (exploded||defused) return; defused=true;
  clearInterval(ticking);
  barEl.style.width='100%';
  led.style.background='radial-gradient(circle at 30% 30%, #bfffe0, var(--accent2))';
  defusedOverlay.style.display='flex';
}

/* ===== REINICIAR ===== */
function restartGame(){
  clearInterval(ticking);
  idx=0; wrong=0; timeLeft=TOTAL_TIME; started=false; exploded=false; defused=false;
  crackImgEl.style.display='none'; restartBtn.style.display='none';
  flashEl.style.display='none'; villainWin.style.display='none';
  defusedOverlay.style.display='none'; dialEl.classList.remove('warnGlow');
  led.style.background='radial-gradient(circle at 30% 30%, #ffa0a0, var(--accent))';
  barEl.style.width='0%';
  // volta para a intro do cientista
  document.getElementById('qcount2').textContent = QUESTIONS.length;
  intro.style.display='flex';
}

/* ===== FULLSCREEN opcional ===== */
async function enterFullscreen(){
  const el=document.documentElement;
  if (el.requestFullscreen) await el.requestFullscreen();
  else if (el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
  else if (el.msRequestFullscreen) await el.msRequestFullscreen();
}
document.getElementById('fsToggle').onclick=async ()=>{ try{ await enterFullscreen(); }catch(e){} };

/* ===== Anti-cola (melhor esforço) ===== */
window.addEventListener('contextmenu', e=> e.preventDefault());
['copy','cut','paste','dragstart'].forEach(evt=> window.addEventListener(evt, e=> e.preventDefault()));
if (CONFIG.strictShortcuts){
  window.addEventListener('keydown',(e)=>{
    const k=e.key.toLowerCase(), ctrl=e.ctrlKey||e.metaKey;
    if (k==='printscreen' || e.keyCode===44){ e.preventDefault(); try{ navigator.clipboard.writeText(''); }catch(_){}
      explode('Tentativa de Print Screen detectada.'); return; }
    if ((ctrl&&(k==='c'||k==='x'||k==='v'||k==='s'||k==='p'||k==='u')) || (ctrl&&e.shiftKey&&(k==='i'||k==='c'||k==='j')) || k==='f12'){
      e.preventDefault(); explode('Atalho bloqueado.'); return;
    }
  },{capture:true});
}
// // se quiser ativar: explode se sair da aba
// window.addEventListener('blur',()=>{ if(started&&!exploded&&!defused) explode('Aba perdeu foco.'); });
// document.addEventListener('visibilitychange',()=>{ if(document.visibilityState!=='visible'&&started&&!exploded&&!defused) explode('Aba oculta.'); });
window.addEventListener('beforeprint',(e)=>{ e.preventDefault(); setTimeout(()=> explode('Tentativa de imprimir.'),0); });

/* ===== Inicialização ===== */
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('qtotal').textContent = QUESTIONS.length;
  document.getElementById('qcount1').textContent = QUESTIONS.length;
  document.getElementById('qcount2').textContent = QUESTIONS.length;

  setTimer(timeLeft); setProgress();

  document.getElementById('restartBtn').addEventListener('click', restartGame);
  document.getElementById('againBtn').addEventListener('click', restartGame);
});
</script>
</body>
</html>
