<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quebra-cabeça Interativo: Lesão Celular</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
    <style>
        html { font-size: 18px; }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f2f5;
            color: #333;
        }
        .main-container.blurred {
            filter: blur(8px) brightness(0.7);
            transition: filter 0.3s ease-in-out;
        }
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 1px; /* Linha preta fina */
            aspect-ratio: 3 / 2;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            padding: 1px; /* Para a borda externa */
            background-color: black;
            overflow: hidden; /* Garante que as bordas arredondadas funcionem */
        }
        .puzzle-piece {
            border: 1px solid black; /* Linha preta ao redor da peça */
            cursor: grab;
            transition: all 0.3s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: rgba(255, 255, 255, 0.85); /* Branco transparente */
            font-family: 'Roboto Slab', serif;
            font-size: 1.75rem;
            font-weight: bold;
            text-shadow: 0 0 5px #000, 0 0 5px #000, 0 0 5px #000; /* Sombra delineada */
            background-image: url('puzzle.jpg');
            background-size: 300% 200%; /* 3 colunas, 2 linhas */
            position: relative;
            overflow: hidden;
        }
        /* Overlay escuro para peças incorretas */
        .puzzle-piece::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            transition: background-color 0.5s ease;
        }
        /* Quando a peça está correta, o overlay fica transparente */
        .puzzle-piece.correct::before {
            background-color: rgba(0, 0, 0, 0);
        }
        .puzzle-piece:hover {
            transform: scale(1.02);
        }
        .puzzle-piece.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .puzzle-piece.correct {
            border: 1px solid #4ade80; /* Borda verde sutil para feedback */
        }
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 50;
        }
        .modal-overlay.active {
            opacity: 1; visibility: visible;
        }
        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #e9eff5 100%);
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-header { padding: 1.5rem 2rem; border-bottom: 1px solid #ddd; }
        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex-grow: 1;
            font-size: 1.25rem;
            line-height: 1.6;
        }
        .modal-footer {
            padding: 1rem 2rem;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-close-btn {
            position: absolute; top: 1rem; right: 1rem;
            background: #e5e7eb; color: #4b5563;
            border-radius: 9999px; width: 3rem; height: 3rem;
            font-size: 2rem; font-weight: bold; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease; z-index: 10;
        }
        .modal-close-btn:hover { background: #d1d5db; transform: rotate(90deg); }
        .slide-title {
            font-family: 'Roboto Slab', serif; color: #1e3a8a;
            font-size: 2.5rem;
        }
        .slide-subtitle {
            font-family: 'Roboto Slab', serif; color: #3b82f6;
            font-size: 2rem;
        }
        .content-card {
            background-color: rgba(255, 255, 255, 0.7);
            border-left: 4px solid #3b82f6;
            border-radius: 0.5rem; padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .mini-slide { display: none; }
        .mini-slide.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .nav-btn {
            background-color: #1e3a8a; color: white;
            padding: 0.75rem 2rem; border-radius: 0.5rem;
            font-weight: bold; transition: background-color 0.2s;
            font-size: 1.25rem;
        }
        .nav-btn:hover { background-color: #3b82f6; }
        .nav-btn:disabled { background-color: #9ca3af; cursor: not-allowed; }
        
        .slide-layout {
            display: flex;
            flex-direction: row;
            gap: 2rem;
            align-items: center;
        }
        .slide-text { flex: 1; }
        .slide-image-container { flex: 1; max-width: 45%; }
        .slide-image {
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: zoom-in;
            transition: transform 0.2s ease;
        }
        .slide-image:hover { transform: scale(1.03); }

        #image-zoom-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease;
            z-index: 100;
        }
        #image-zoom-overlay.active { opacity: 1; visibility: visible; }
        #image-zoom-content {
            max-width: 90vw;
            max-height: 90vh;
        }
        #image-zoom-close {
            position: absolute; top: 2rem; right: 2rem;
            color: white; font-size: 3rem; font-weight: bold;
            cursor: pointer;
        }
        .quiz-option.selected {
            outline: 3px solid #3b82f6;
            border-radius: 0.5rem;
        }
        .table-auto { width: 100%; border-collapse: collapse; }
        .table-auto th, .table-auto td { border: 1px solid #ddd; padding: 0.75rem; text-align: left; }
        .table-auto th { background-color: #e9eff5; font-family: 'Roboto Slab', serif; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="main-container" class="max-w-7xl mx-auto transition-all duration-300">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold slide-title" style="font-size: 3.5rem;">Lesão Celular: Quebra-cabeça Interativo</h1>
            <p class="text-lg text-gray-600 mt-2" style="font-size: 1.5rem;">Arraste as peças para montar o quebra-cabeça e clique para explorar.</p>
        </header>

        <main id="puzzle-grid" class="puzzle-grid">
            <!-- As peças serão inseridas aqui pelo JavaScript -->
        </main>
    </div>

    <!-- ===== MODALS ===== -->

    <!-- Modal Lesão Reversível -->
    <div id="modal-reversivel" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-header"><h2 class="slide-title text-3xl font-bold">Lesão Celular Reversível</h2></div>
            <div class="modal-body">
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">O Epicentro do Problema: Falha Energética</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>A depleção de ATP é o evento central na lesão hipóxica e em muitas lesões químicas. A isquemia (perda de suprimento sanguíneo) é mais danosa que a hipóxia (oxigênio reduzido), pois cessa o fornecimento de substratos para glicólise e a remoção de metabólitos tóxicos.</p>
                            <p class="mt-2"><strong>Consequências da Depleção de ATP:</strong></p>
                            <ul class="list-disc list-inside space-y-2 mt-2">
                                <li><strong>Falha da Bomba de Na⁺/K⁺-ATPase:</strong> Esta bomba dependente de ATP falha, causando influxo de Na⁺ e água, e efluxo de K⁺. O ganho líquido de soluto é acompanhado por ganho de água, gerando o edema celular (tumefação).</li>
                                <li><strong>Glicólise Anaeróbica:</strong> Para compensar a falta de ATP, a célula aumenta a glicólise anaeróbica, consumindo glicogênio e acumulando ácido lático. Isso diminui o pH intracelular, causando agregação da cromatina nuclear.</li>
                                <li><strong>Redução da Síntese Proteica:</strong> Ocorre pelo desprendimento de ribossomos do Retículo Endoplasmático Rugoso (RER), que também se encontra edemaciado.</li>
                            </ul>
                        </div>
                        <div class="slide-image-container">
                            <img src="edema_celular.jpg" alt="Edema Celular" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Morfologia: Degeneração Hidrópica</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p><strong>Macroscopia:</strong> O órgão afetado torna-se pálido (pela compressão dos capilares), túrgido e aumenta de peso.</p>
                            <p class="mt-2"><strong>Microscopia:</strong> Os primeiros sinais são a <strong>Tumefação Celular</strong> (ou <strong>alteração hidrópica</strong> / <strong>degeneração vacuolar</strong>), com citoplasma granular e pequenos vacúolos claros, que representam segmentos distendidos do RE. Outras alterações incluem bolhas na membrana plasmática (blebs), <strong>figuras de mielina</strong> (agregados de fosfolipídios de membranas danificadas) e edema de mitocôndrias e RER.</p>
                        </div>
                        <div class="slide-image-container">
                             <img src="edema_celular2.jpg" alt="Alteração Hidrópica" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Morfologia: Esteatose</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                             <p>A <strong>Degeneração Gordurosa (Esteatose)</strong> é outra manifestação de lesão reversível, caracterizada pelo acúmulo de vacúolos de triglicerídeos no citoplasma. É comum em células que metabolizam gordura, como hepatócitos e miócitos cardíacos, em resposta a injúrias como álcool, toxinas, obesidade e diabetes.</p>
                        </div>
                        <div class="slide-image-container">
                             <img src="esteatose.jpg" alt="Esteatose Hepática" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                 <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Comparativo: Lesão Reversível vs. Irreversível</h3>
                    <div class="content-card overflow-x-auto">
                        <table class="table-auto">
                            <thead>
                                <tr><th>Tipo de Lesão</th><th>Características Gerais</th><th>Potencial de Recuperação</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>Reversível</td><td>Alterações funcionais e estruturais transitórias, como edema celular e esteatose. Não há dano letal à membrana plasmática ou às organelas vitais.</td><td>Sim, com a remoção do agente agressor e a restauração da homeostase.</td></tr>
                                <tr><td>Irreversível</td><td>Comprometimento estrutural grave e permanente das membranas (plasmática, lisossomal, mitocondrial) e do núcleo.</td><td>Não, a célula ultrapassou o "ponto de não retorno" e evolui para morte celular (necrose ou apoptose).</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="nav-btn prev-slide">Anterior</button>
                <span class="slide-counter font-semibold"></span>
                <button class="nav-btn next-slide">Próximo</button>
            </div>
        </div>
    </div>

    <!-- Modal Lesão Irreversível -->
    <div id="modal-irreversivel" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-header"><h2 class="slide-title text-3xl font-bold">Lesão Celular Irreversível</h2></div>
            <div class="modal-body">
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">O Ponto de Não Retorno</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>O dano se torna irrecuperável quando a lesão persiste ou é severa. Três fenômenos marcam a irreversibilidade:</p>
                            <ul class="list-disc list-inside space-y-2 mt-2">
                                <li><strong>Incapacidade de Restaurar a Função Mitocondrial:</strong> A formação do poro de transição de permeabilidade mitocondrial impede a fosforilação oxidativa e a geração de ATP de forma permanente.</li>
                                <li><strong>Danos Profundos às Membranas:</strong> A perda da integridade das membranas é o marco central. A ruptura da membrana plasmática leva à perda de conteúdo celular. A ruptura dos lisossomos libera enzimas hidrolíticas que digerem a célula (autólise).</li>
                                <li><strong>Influxo Maciço de Cálcio:</strong> O aumento do Ca²⁺ citosólico ativa enzimas destrutivas: fosfolipases (danificam membranas), proteases (degradam proteínas), ATPases (aceleram depleção de ATP) e endonucleases (fragmentam DNA).</li>
                            </ul>
                        </div>
                        <div class="slide-image-container">
                             <img src="ruptura_membrana.jpg" alt="Ruptura da Membrana" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                     <div class="content-card flex justify-center items-center">
                        <img src="mecanismos_morte.jpg" alt="Mecanismos da Morte Celular" class="slide-image max-w-full md:max-w-3xl" onerror="this.onerror=null;this.src='https://placehold.co/800x600/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Morfologia da Morte Celular por Necrose</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                        <p>A morte por necrose é caracterizada por desnaturação de proteínas e digestão enzimática. Histologicamente, vemos um <strong>aumento da eosinofilia citoplasmática</strong> (aparência vítrea e rosada pela perda de RNA e desnaturação proteica) e alterações nucleares patognomônicas:</p>
                        <ul class="list-disc list-inside space-y-2 mt-2">
                            <li><strong>Picnose:</strong> Condensação e encolhimento do núcleo, que se torna menor e mais basofílico (escuro).</li>
                            <li><strong>Cariorrexe:</strong> Fragmentação do núcleo picnótico em múltiplos pedaços.</li>
                            <li><strong>Cariólise:</strong> Dissolução completa do núcleo pela ação de DNAses, resultando no desaparecimento da basofilia nuclear. Em 1 a 2 dias, o núcleo pode desaparecer completamente.</li>
                        </ul>
                        </div>
                        <div class="slide-image-container">
                             <img src="alteracoes_nucleares.jpg" alt="Alterações Nucleares da Necrose" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Agentes Etiológicos e Mecanismos</h3>
                    <div class="content-card overflow-x-auto">
                        <table class="table-auto">
                            <thead>
                                <tr><th>Agente Etiológico</th><th>Mecanismos Principais</th><th>Resultados Típicos</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>Hipóxia / Isquemia</td><td>Depleção massiva de ATP, falha da Na⁺/K⁺-ATPase, acidose, influxo de Ca²⁺.</td><td><strong>Rev:</strong> Edema celular. <br><strong>Irrev:</strong> Necrose Coagulativa (ou Liquefativa no cérebro).</td></tr>
                                <tr><td>Agentes Físicos</td><td>Trauma, temperaturas extremas, radiação. Ruptura de membranas, radicais livres, dano ao DNA.</td><td><strong>Irrev:</strong> Necrose, Apoptose (radiação).</td></tr>
                                <tr><td>Agentes Químicos</td><td>Toxicidade direta (ex: cianeto) ou conversão em metabólitos tóxicos (ex: CCl₄).</td><td><strong>Rev:</strong> Esteatose. <br><strong>Irrev:</strong> Necrose (overdose), Apoptose (quimioterápicos).</td></tr>
                                <tr><td>Agentes Infecciosos</td><td>Toxinas, resposta imune citotóxica, enzimas líticas.</td><td><strong>Irrev:</strong> Apoptose (vírus), Necrose Liquefativa (bactérias).</td></tr>
                                <tr><td>Reações Imunológicas</td><td>Ação de linfócitos T citotóxicos, ativação do sistema complemento, imunocomplexos.</td><td><strong>Irrev:</strong> Apoptose (autoimunidade), Necrose Fibrinoide (vasculites).</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="nav-btn prev-slide">Anterior</button>
                <span class="slide-counter font-semibold"></span>
                <button class="nav-btn next-slide">Próximo</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Necrose -->
    <div id="modal-necrose" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-header"><h2 class="slide-title text-3xl font-bold">Necrose</h2></div>
            <div class="modal-body">
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Necrose Coagulativa</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>A arquitetura do tecido morto é preservada por dias. A desnaturação de proteínas estruturais e enzimas (incluindo as líticas) predomina, bloqueando a proteólise das células mortas. O tecido fica firme e pálido. É a forma típica de necrose em infartos (morte isquêmica) em todos os órgãos sólidos, <strong>exceto o cérebro</strong>.</p>
                        </div>
                        <div class="slide-image-container">
                            <img src="necrose_coagulativa.jpg" alt="Necrose Coagulativa" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Necrose Liquefativa</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>A digestão enzimática predomina sobre a desnaturação, transformando o tecido em uma massa viscosa e líquida. Ocorre em duas situações principais: <strong>infecções bacterianas ou fúngicas</strong>, que atraem leucócitos que liberam suas enzimas (heterólise), formando o <strong>pus</strong>; e na <strong>morte isquêmica do sistema nervoso central</strong>.</p>
                        </div>
                        <div class="slide-image-container">
                             <img src="necrose_liquefativa.jpg" alt="Necrose Liquefativa" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Necrose Caseosa</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>Uma combinação de necrose coagulativa e liquefativa, com aspecto macroscópico de "queijo cottage", friável e branco-amarelado. Microscopicamente, a arquitetura tecidual é obliterada e substituída por uma massa amorfa, granular e eosinofílica, cercada por uma borda inflamatória conhecida como <strong>granuloma</strong>. É a marca registrada da <strong>Tuberculose</strong>.</p>
                        </div>
                         <div class="slide-image-container">
                            <img src="necrose_caseosa.jpg" alt="Necrose Caseosa" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Necrose Gordurosa</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>Refere-se a áreas focais de destruição de gordura, tipicamente por liberação de lipases pancreáticas ativadas. Na <strong>Pancreatite Aguda</strong>, as lipases digerem os triglicerídeos dos adipócitos, e os ácidos graxos liberados se combinam com cálcio (<strong>saponificação</strong>), formando depósitos brancos e calcificados com aspecto de giz.</p>
                        </div>
                         <div class="slide-image-container">
                            <img src="necrose_gordurosa.jpg" alt="Necrose Gordurosa" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Necrose Fibrinoide</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>Uma forma especial de necrose visível apenas microscopicamente, ocorrendo em paredes de vasos sanguíneos. É associada a reações imunes (vasculites por imunocomplexos) ou hipertensão maligna. Caracteriza-se por um depósito eosinofílico, brilhante e amorfo (semelhante à fibrina) na parede do vaso.</p>
                        </div>
                         <div class="slide-image-container">
                            <img src="necrose_fibrinoide.jpg" alt="Necrose Fibrinoide" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Gangrena</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>Não é um padrão de necrose, mas um termo clínico para a necrose de um membro que perdeu seu suprimento sanguíneo. <strong>Gangrena seca</strong> refere-se a uma necrose de coagulação predominante. <strong>Gangrena úmida</strong> ocorre quando há uma infecção bacteriana sobreposta, adicionando um componente de necrose liquefativa pela ação das enzimas de bactérias e leucócitos.</p>
                        </div>
                         <div class="slide-image-container">
                            <img src="gangrena.jpg" alt="Gangrena" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="nav-btn prev-slide">Anterior</button>
                <span class="slide-counter font-semibold"></span>
                <button class="nav-btn next-slide">Próximo</button>
            </div>
        </div>
    </div>

    <!-- Modal Apoptose -->
    <div id="modal-apoptose" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-header"><h2 class="slide-title text-3xl font-bold">Apoptose</h2></div>
            <div class="modal-body">
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">A Morte "Silenciosa" e Programada</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p>É uma via de morte celular induzida por um programa de suicídio rigidamente controlado. Enzimas chamadas <strong>caspases</strong> são ativadas e desmontam a célula de forma ordenada, degradando o DNA e as proteínas. A membrana celular permanece intacta, mas é alterada para atrair fagócitos (ex: a fosfatidilserina é "lançada" para a face externa). Os restos celulares são empacotados em <strong>corpos apoptóticos</strong>, que são rapidamente fagocitados, <strong>sem gerar inflamação</strong>.</p>
                        </div>
                        <div class="slide-image-container">
                            <img src="apoptose.jpg" alt="Corpos Apoptóticos" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Vias de Ativação Molecular</h3>
                    <div class="content-card slide-layout">
                        <div class="slide-text">
                            <p><strong>Via Intrínseca (Mitocondrial):</strong> É a principal via. Acionada por estresse interno (dano ao DNA, acúmulo de proteínas mal-enoveladas, privação de fatores de crescimento). Regulada pela família de proteínas <strong>Bcl-2</strong>, que inclui membros pró-apoptóticos (<strong>Bax, Bak</strong>) e anti-apoptóticos (<strong>Bcl-2, Bcl-xL</strong>). O estresse ativa sensores (proteínas <strong>BH3-only</strong>), que por sua vez ativam Bax e Bak. Estes aumentam a permeabilidade da membrana mitocondrial, liberando <strong>citocromo c</strong>. O citocromo c se liga ao APAF-1, ativando a <strong>Caspase-9</strong> (caspase iniciadora).</p>
                            <p class="mt-4"><strong>Via Extrínseca (Receptores de Morte):</strong> Iniciada por sinais externos. Células expressam receptores de morte na superfície, como o <strong>Fas (CD95)</strong> e o receptor de TNF. A ligação do ligante (FasL) ao receptor Fas recruta proteínas adaptadoras que ativam a <strong>Caspase-8</strong> (outra caspase iniciadora).</p>
                            <p class="mt-4">Ambas as vias convergem na ativação das <strong>caspases executoras</strong> (como a <strong>Caspase-3</strong>), que realizam a demolição celular.</p>
                        </div>
                         <div class="slide-image-container">
                            <img src="apoptose2.jpg" alt="Vias da Apoptose" class="slide-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                        </div>
                    </div>
                </div>
                 <div class="mini-slide">
                    <h3 class="slide-subtitle text-2xl font-bold mb-3">Necrose vs. Apoptose</h3>
                    <div class="content-card overflow-x-auto">
                        <table class="table-auto">
                            <thead>
                                <tr><th>Característica</th><th>Necrose</th><th>Apoptose</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>Tamanho Celular</td><td>Edema (inchaço)</td><td>Retração (encolhimento)</td></tr>
                                <tr><td>Núcleo</td><td>Picnose → Cariorrexe → Cariólise</td><td>Condensação e fragmentação em tamanhos de nucleossomos</td></tr>
                                <tr><td>Membrana Plasmática</td><td>Rompida</td><td>Íntegra; alterada para sinalizar fagocitose</td></tr>
                                <tr><td>Conteúdo Celular</td><td>Extravasamento e digestão enzimática</td><td>Empacotado em corpos apoptóticos</td></tr>
                                <tr><td>Inflamação</td><td>Frequentemente presente e significativa</td><td>Ausente; morte "limpa"</td></tr>
                                <tr><td>Papel</td><td>Sempre patológico (resultado de lesão)</td><td>Fisiológico (ex: embriogênese) e patológico (ex: dano ao DNA)</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="nav-btn prev-slide">Anterior</button>
                <span class="slide-counter font-semibold"></span>
                <button class="nav-btn next-slide">Próximo</button>
            </div>
        </div>
    </div>

    <!-- Modal Quiz -->
    <div id="modal-quiz" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-header"><h2 class="slide-title text-3xl font-bold">Quiz Rápido</h2></div>
            <div class="modal-body">
                <div id="quiz-container"></div>
                <div id="quiz-result" class="mt-4 font-bold text-2xl text-center"></div>
            </div>
        </div>
    </div>

    <!-- Image Zoom Modal -->
    <div id="image-zoom-overlay" class="modal-overlay">
        <span id="image-zoom-close">&times;</span>
        <img id="image-zoom-content" src="" alt="Imagem Ampliada">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainContainer = document.getElementById('main-container');
            const puzzleGrid = document.getElementById('puzzle-grid');
            const modals = document.querySelectorAll('.modal-overlay:not(#image-zoom-overlay)');
            const imageZoomOverlay = document.getElementById('image-zoom-overlay');
            const imageZoomContent = document.getElementById('image-zoom-content');
            const imageZoomClose = document.getElementById('image-zoom-close');

            const pieceData = [
                { modal: 'modal-reversivel', text: 'Lesão Reversível', correctIndex: 0 },
                { modal: 'modal-irreversivel', text: 'Lesão Irreversível', correctIndex: 1 },
                { modal: 'modal-necrose', text: 'Necrose', correctIndex: 2 },
                { modal: 'modal-apoptose', text: 'Apoptose', correctIndex: 3 },
                { modal: 'modal-quiz', text: 'Quiz Interativo', correctIndex: 4 },
                { id: 'print-piece', text: 'Imprimir Apostila', correctIndex: 5 }
            ];

            let draggedPiece = null;

            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function createPuzzle() {
                puzzleGrid.innerHTML = '';
                const piecesInOrder = [];

                pieceData.forEach((data, index) => {
                    const piece = document.createElement('div');
                    piece.className = 'puzzle-piece';
                    piece.textContent = data.text;
                    piece.dataset.modal = data.modal;
                    piece.dataset.correctIndex = data.correctIndex;
                    if (data.id) piece.id = data.id;
                    piece.draggable = true;

                    const col = index % 3;
                    const row = Math.floor(index / 3);
                    const xPos = col * 50;
                    const yPos = row * 100;
                    piece.style.backgroundPosition = `${xPos}% ${yPos}%`;
                    
                    piecesInOrder.push(piece);
                });

                const shuffledPieces = shuffle(piecesInOrder);
                shuffledPieces.forEach(piece => {
                    puzzleGrid.appendChild(piece);
                });
                
                addDragListeners();
                checkCorrectness();
            }

            function addDragListeners() {
                const pieces = document.querySelectorAll('.puzzle-piece');
                pieces.forEach(piece => {
                    piece.addEventListener('dragstart', handleDragStart);
                    piece.addEventListener('dragover', handleDragOver);
                    piece.addEventListener('drop', handleDrop);
                    piece.addEventListener('dragend', handleDragEnd);
                    
                    if (piece.dataset.modal && piece.dataset.modal !== 'undefined') {
                         piece.addEventListener('click', () => openModal(document.getElementById(piece.dataset.modal)));
                    } else if (piece.id === 'print-piece') {
                        piece.addEventListener('click', handlePrint);
                    }
                });
            }

            function handleDragStart(e) {
                draggedPiece = e.target;
                setTimeout(() => e.target.classList.add('dragging'), 0);
            }

            function handleDragOver(e) {
                e.preventDefault();
            }

            function handleDrop(e) {
                e.preventDefault();
                const targetPiece = e.target.closest('.puzzle-piece');
                if (draggedPiece && targetPiece && draggedPiece !== targetPiece) {
                    // Complex swap logic to handle all cases
                    const parent = puzzleGrid;
                    const draggedIndex = Array.from(parent.children).indexOf(draggedPiece);
                    const targetIndex = Array.from(parent.children).indexOf(targetPiece);

                    if (draggedIndex > targetIndex) {
                         parent.insertBefore(draggedPiece, targetPiece);
                    } else {
                         parent.insertBefore(draggedPiece, targetPiece.nextSibling);
                    }
                }
                checkCorrectness();
            }

            function handleDragEnd(e) {
                e.target.classList.remove('dragging');
                draggedPiece = null;
            }
            
            function checkCorrectness() {
                const pieces = puzzleGrid.querySelectorAll('.puzzle-piece');
                let allCorrect = true;
                pieces.forEach((piece, index) => {
                    if (parseInt(piece.dataset.correctIndex) === index) {
                        piece.classList.add('correct');
                    } else {
                        piece.classList.remove('correct');
                        allCorrect = false;
                    }
                });
                
                if (allCorrect) {
                    // Optional: Add a success message or effect
                    console.log("Parabéns, quebra-cabeça completo!");
                }
            }


            // Setup Modals
            modals.forEach(modal => {
                const closeBtn = modal.querySelector('.modal-close-btn');
                closeBtn.addEventListener('click', () => closeModal(modal));
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal(modal);
                });

                const slides = modal.querySelectorAll('.mini-slide');
                if (slides.length > 0) {
                    let currentSlide = 0;
                    const prevBtn = modal.querySelector('.prev-slide');
                    const nextBtn = modal.querySelector('.next-slide');
                    const counter = modal.querySelector('.slide-counter');

                    function showSlide(index) {
                        slides.forEach((slide, i) => slide.classList.toggle('active', i === index));
                        currentSlide = index;
                        counter.textContent = `Slide ${index + 1} de ${slides.length}`;
                        prevBtn.disabled = index === 0;
                        nextBtn.disabled = index === slides.length - 1;
                    }
                    prevBtn.addEventListener('click', () => showSlide(currentSlide - 1));
                    nextBtn.addEventListener('click', () => showSlide(currentSlide + 1));
                    modal.resetSlideshow = () => showSlide(0);
                }
            });

            function openModal(modal) {
                if (!modal) return;
                mainContainer.classList.add('blurred');
                modal.classList.add('active');
                if (modal.resetSlideshow) modal.resetSlideshow();
                if (modal.id === 'modal-quiz') loadQuiz();
            }

            function closeModal(modal) {
                mainContainer.classList.remove('blurred');
                modal.classList.remove('active');
            }

            // Image Zoom Logic
            document.querySelectorAll('.slide-image').forEach(image => {
                image.addEventListener('click', () => {
                    imageZoomContent.src = image.src;
                    imageZoomOverlay.classList.add('active');
                });
            });

            const closeZoom = () => imageZoomOverlay.classList.remove('active');
            imageZoomOverlay.addEventListener('click', closeZoom);
            imageZoomClose.addEventListener('click', closeZoom);

            // Quiz Logic
            const quizData = [
                { question: "Um paciente com pancreatite aguda grave desenvolve áreas de saponificação no mesentério. Qual padrão de necrose está associado a este achado?", options: ["Coagulativa", "Liquefativa", "Caseosa", "Gordurosa"], answer: "Gordurosa" },
                { question: "A remoção de linfócitos T autorreativos no timo é um processo fisiológico crucial para a tolerância imunológica. Qual mecanismo de morte celular é predominante neste processo?", options: ["Necrose", "Apoptose", "Necroptose", "Autofagia"], answer: "Apoptose" },
                { question: "Após um infarto cerebral, a área lesionada evolui para uma cavidade cística. Este desfecho é característico de qual tipo de necrose?", options: ["Coagulativa", "Liquefativa", "Caseosa", "Fibrinoide"], answer: "Liquefativa" },
                { question: "A proteína p53, o 'guardião do genoma', interrompe o ciclo celular em caso de dano ao DNA. Se o dano for irreparável, a p53 induz a morte celular principalmente através da:", options: ["Ativação de receptores de morte (via extrínseca)", "Inibição da família Bcl-2", "Ativação de membros pró-apoptóticos da família Bcl-2 (via intrínseca)", "Indução de necrose inflamatória"], answer: "Ativação de membros pró-apoptóticos da família Bcl-2 (via intrínseca)" },
                { question: "Um paciente com tuberculose pulmonar realiza uma biópsia que revela um granuloma com um centro amorfo e esbranquiçado. Qual é o padrão de necrose encontrado?", options: ["Liquefativa", "Coagulativa", "Caseosa", "Gordurosa"], answer: "Caseosa" },
                { question: "Qual evento molecular é considerado o 'ponto de não retorno' definitivo, selando o destino de uma célula para a necrose?", options: ["Edema celular inicial", "Queda do pH intracelular", "Dano irreversível e permeabilização das membranas", "Desprendimento de ribossomos"], answer: "Dano irreversível e permeabilização das membranas" },
                { question: "A principal diferença entre isquemia e hipóxia é que a isquemia também envolve:", options: ["Aumento da produção de ATP", "Aumento da temperatura local", "Cessação do fornecimento de substratos e remoção de metabólitos", "Aumento da pressão parcial de oxigênio"], answer: "Cessação do fornecimento de substratos e remoção de metabólitos" },
                { question: "Um paciente com hipertensão maligna apresenta dano em arteríolas renais, com deposição de material eosinofílico brilhante na parede vascular. Qual tipo de necrose é este?", options: ["Coagulativa", "Liquefativa", "Caseosa", "Fibrinoide"], answer: "Fibrinoide" },
                { question: "A ativação da cascata de caspases é um evento central em qual processo?", options: ["Lesão reversível", "Necrose coagulativa", "Apoptose", "Esteatose"], answer: "Apoptose" },
                { question: "A presença de qual característica histológica distingue fundamentalmente a necrose da apoptose em um tecido?", options: ["Encolhimento celular", "Condensação da cromatina", "Infiltrado inflamatório agudo", "Fragmentação do DNA"], answer: "Infiltrado inflamatório agudo" }
            ];

            function loadQuiz() {
                const quizContainer = document.getElementById('quiz-container');
                const quizResult = document.getElementById('quiz-result');
                quizContainer.innerHTML = '';
                quizResult.innerHTML = '';
                quizData.forEach((q, index) => {
                    const questionEl = document.createElement('div');
                    questionEl.classList.add('mb-6', 'content-card');
                    let optionsHtml = q.options.map(option => `<label class="quiz-option block mt-2 text-xl p-2"><input type="radio" name="question${index}" value="${option}" class="mr-3">${option}</label>`).join('');
                    questionEl.innerHTML = `<p class="font-semibold text-2xl">${index + 1}. ${q.question}</p><div class="mt-2">${optionsHtml}</div>`;
                    quizContainer.appendChild(questionEl);
                });

                quizContainer.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', (event) => {
                        const name = event.target.name;
                        document.querySelectorAll(`input[name="${name}"]`).forEach(sibling => {
                            sibling.parentElement.classList.remove('selected');
                        });
                        event.target.parentElement.classList.add('selected');
                    });
                });

                const submitButton = document.createElement('button');
                submitButton.textContent = 'Verificar Respostas';
                submitButton.className = 'nav-btn block mx-auto mt-6';
                submitButton.onclick = checkQuizAnswers;
                quizContainer.appendChild(submitButton);
            }

            function checkQuizAnswers() {
                let score = 0;
                quizData.forEach((q, index) => {
                    const selected = document.querySelector(`input[name="question${index}"]:checked`);
                    const questionCard = document.querySelectorAll('#quiz-container .content-card')[index];
                    
                    // Reset styles
                    questionCard.style.borderLeftColor = '#3b82f6';

                    if (selected) {
                        if (selected.value === q.answer) {
                            score++;
                            questionCard.style.borderLeft = '4px solid #22c55e'; // Green for correct
                        } else {
                            questionCard.style.borderLeft = '4px solid #ef4444'; // Red for incorrect
                        }
                    }
                });
                document.getElementById('quiz-result').textContent = `Você acertou ${score} de ${quizData.length} perguntas!`;
            }

            // Print Logic
            function handlePrint() {
                const newWindow = window.open('', '_blank');
                let fullContent = `
                    <!DOCTYPE html>
                    <html lang="pt-BR">
                    <head>
                        <meta charset="UTF-8">
                        <title>Apostila: Lesão Celular</title>
                        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
                        <style>
                            body { font-family: 'Roboto', sans-serif; line-height: 1.6; margin: 2rem; color: #333; }
                            h1, h2, h3, h4 { font-family: 'Roboto Slab', serif; color: #1e3a8a; }
                            h1 { font-size: 2.5rem; text-align: center; border-bottom: 2px solid #1e3a8a; padding-bottom: 1rem; margin-bottom: 2rem; }
                            .print-section { page-break-inside: avoid; margin-bottom: 2rem; border-top: 1px solid #ccc; padding-top: 2rem; }
                            .print-section:first-of-type { border-top: none; }
                            .content-card { border-left: 4px solid #3b82f6; padding: 1rem; background-color: #f8f9fa; margin: 1rem 0; border-radius: 8px; }
                            ul { padding-left: 20px; }
                            table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
                            th, td { border: 1px solid #ddd; padding: 0.5rem; text-align: left; }
                            th { background-color: #e9eff5; }
                            .slide-layout { display: block; page-break-inside: avoid; }
                            .slide-image-container { display: block; text-align: center; margin-top: 1rem; }
                            .slide-image { max-width: 70%; height: auto; border-radius: 8px; display: inline-block; }
                        </style>
                    </head>
                    <body>
                        <h1>Apostila Completa: Lesão Celular</h1>
                `;
                
                document.querySelectorAll('.modal-overlay:not(#modal-quiz):not(#image-zoom-overlay)').forEach(modal => {
                    const header = modal.querySelector('.modal-header');
                    const body = modal.querySelector('.modal-body');
                    if (header && body) {
                        const tempBody = document.createElement('div');
                        tempBody.innerHTML = body.innerHTML;
                        
                        // Create a new DOM from the tempBody to query it
                        const newDom = new DOMParser().parseFromString(tempBody.innerHTML, 'text/html');

                        // Replace image sources for printing
                        newDom.querySelectorAll('.slide-image').forEach(img => {
                            const originalSrc = img.getAttribute('src');
                            // This assumes you have access to the original image element to get its src
                            // Since we are in a new context, we need to find the original image
                            // A better approach would be to pass the whole modal content.
                            // Let's find the corresponding image in the main document.
                            const originalImage = document.querySelector(`img[src="${originalSrc}"]`);
                            if(originalImage) {
                                img.src = originalImage.src;
                            }
                        });

                        tempBody.innerHTML = newDom.body.innerHTML;

                        tempBody.querySelectorAll('.mini-slide').forEach(slide => {
                            slide.style.display = 'block';
                        });
                        fullContent += `<div class="print-section">${header.innerHTML}${tempBody.innerHTML}</div>`;
                    }
                });

                fullContent += `</body></html>`;
                
                newWindow.document.open();
                newWindow.document.write(fullContent);
                newWindow.document.close();
                setTimeout(() => newWindow.print(), 500);
            }

            // Initial setup
            createPuzzle();
        });
    </script>
</body>
</html>
