<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Slides Epidemiol√≥gicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .step-card {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .progress-bar-fill {
            transition: width 0.4s ease-in-out;
        }
        .infection-btn {
            transition: all 0.2s ease-in-out;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .infection-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: #4ECDC4;
        }
        .infection-btn.selected {
            background-color: #4ECDC4;
            color: #1A535C;
            border-color: #4ECDC4;
            font-weight: 600;
        }
        .variable-btn {
            transition: all 0.2s ease-in-out;
        }
        .variable-btn.active {
            background-color: #4ECDC4 !important;
            color: #1A535C !important;
            font-weight: 600;
        }
        .data-input-cell {
            padding: 8px;
            border: 1px solid #4a5568;
            min-width: 80px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="container mx-auto max-w-5xl">
        <div id="app" class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden border border-gray-700" style="background: linear-gradient(145deg, #2d3748, #1a202c);">
            
            <div class="p-6 border-b border-gray-700">
                <h1 class="text-3xl font-bold text-gray-100 text-center mb-4">Gerador de Apresenta√ß√£o Epidemiol√≥gica</h1>
                <div class="w-full bg-gray-700 rounded-full h-3">
                    <div id="progressBar" class="h-3 rounded-full progress-bar-fill" style="width: 25%; background: linear-gradient(90deg, #4ECDC4, #F7B801);"></div>
                </div>
                 <p id="step-indicator" class="text-center text-sm text-gray-400 mt-2">Passo 1 de 4</p>
            </div>

            <div id="steps-container" class="p-8">
                <!-- Passo 1: Sele√ß√£o da Infec√ß√£o -->
                <div id="step-1" class="step-card">
                    <h2 class="text-2xl font-semibold mb-6 text-gray-200">1. Escolha a Infec√ß√£o para An√°lise</h2>
                    <div id="infection-list" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Op√ß√µes de infec√ß√£o -->
                    </div>
                </div>

                <!-- Passo 2: Visualiza√ß√£o dos Dados -->
                <div id="step-2" class="step-card hidden">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-200">2. Visualiza√ß√£o dos Dados Brutos</h2>
                    <p class="text-gray-400 mb-4">A tabela abaixo exibe os dados originais utilizados para a an√°lise. Clique em "Pr√≥xima" para continuar.</p>
                    <div class="h-80 overflow-auto border border-gray-600 rounded-lg p-2 bg-gray-900/50">
                        <table id="data-table" class="min-w-full text-sm text-left">
                            <thead class="bg-gray-700 sticky top-0"></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Passo 3: An√°lise Descritiva -->
                <div id="step-3" class="step-card hidden">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-200">3. An√°lise Descritiva dos Dados</h2>
                    <p class="text-gray-400 mb-6">Selecione uma vari√°vel na lista √† esquerda para visualizar as m√©tricas de tend√™ncia central √† direita.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 min-h-[400px]">
                        <div id="variable-buttons" class="flex flex-col gap-2 overflow-y-auto max-h-[400px] pr-2">
                            <!-- Bot√µes das vari√°veis -->
                        </div>
                        <div id="metrics-display-container" class="md:col-span-2 bg-gray-900/50 p-6 rounded-lg border border-gray-700 flex flex-col justify-center">
                           <!-- As m√©tricas ser√£o exibidas aqui -->
                        </div>
                    </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                        <div>
                            <label for="observations" class="block mb-2 text-sm font-medium text-gray-300">Observa√ß√µes sobre os Dados:</label>
                            <textarea id="observations" rows="4" class="block p-2.5 w-full text-sm bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-cyan-500 focus:border-cyan-500" placeholder="Digite suas observa√ß√µes aqui..."></textarea>
                        </div>
                        <div>
                            <label for="conclusion" class="block mb-2 text-sm font-medium text-gray-300">Conclus√£o Epidemiol√≥gica:</label>
                            <textarea id="conclusion" rows="4" class="block p-2.5 w-full text-sm bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-cyan-500 focus:border-cyan-500" placeholder="Digite sua conclus√£o aqui..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Passo 4: Layout e Finaliza√ß√£o -->
                <div id="step-4" class="step-card hidden">
                    <h2 class="text-2xl font-semibold mb-6 text-gray-200">4. Finalizar Apresenta√ß√£o</h2>
                    <div class="mb-6">
                        <label class="block mb-2 text-sm font-medium text-gray-300">Escolha um Layout (Cor do Tema):</label>
                        <div id="layout-options" class="flex flex-wrap gap-4">
                            <!-- Op√ß√µes de Layout -->
                        </div>
                    </div>
                    <div>
                        <label for="authors" class="block mb-2 text-sm font-medium text-gray-300">Respons√°veis pelo Relat√≥rio:</label>
                        <input type="text" id="authors" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-2.5" placeholder="Ex: Jo√£o da Silva, Maria Oliveira">
                    </div>
                </div>
            </div>

            <!-- Navega√ß√£o -->
            <div class="flex justify-between p-6 bg-gray-900/50 border-t border-gray-700">
                <button id="prev-btn" class="py-2 px-5 rounded-lg text-white font-semibold bg-gray-600 hover:bg-gray-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors">Anterior</button>
                <button id="next-btn" class="py-2 px-5 rounded-lg text-gray-900 font-semibold bg-cyan-400 hover:bg-cyan-300 disabled:bg-cyan-800 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors">Pr√≥xima</button>
                <button id="generate-btn" class="py-2 px-5 rounded-lg text-white font-semibold bg-green-500 hover:bg-green-400 hidden disabled:bg-green-800 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors">Gerar Apresenta√ß√£o</button>
            </div>
        </div>
    </div>

<script>
const state = {
    currentStep: 1,
    selectedInfection: null,
    analysis: {
        observations: '',
        conclusion: ''
    },
    presentation: {
        layout: 'teal',
        authors: ''
    },
    data: {},
};

const infectionData = {
    'Dengue': {
        rawData: `Paciente,Sexo,Idade,Febre alta s√∫bita,Cefaleia intensa,Mialgia/artralgia,Exantema,Dor retro-orbit√°ria,Plaquetas <100.000,Hemoconcentra√ß√£o (Ht ‚Üë),Dor abdominal intensa,Sangramento,Sorologia NS1/IgM positiva
1,F,22,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
2,M,35,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,N√£o,Sim,Sim
3,F,28,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,N√£o,Sim
4,M,41,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
5,F,19,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
6,M,56,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
7,F,33,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,N√£o,Sim
8,M,27,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
9,F,48,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,N√£o,Sim
10,M,52,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,Sim,Sim,Sim
11,F,30,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,N√£o,Sim
12,M,44,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
13,F,25,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
14,M,39,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
15,F,21,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
16,M,47,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,N√£o,Sim
17,F,34,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
18,M,50,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
19,F,29,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
20,M,61,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim`,
        info: {
            introduction: `<ul><li><strong>Fam√≠lia:</strong> Flaviviridae</li><li><strong>G√™nero:</strong> Flavivirus</li><li><strong>Esp√©cie:</strong> V√≠rus da Dengue (DENV)</li><li><strong>Genoma:</strong> RNA de fita simples, sentido positivo.</li><li><strong>Morfologia:</strong> Part√≠cula esf√©rica, envelopada, com aproximadamente 50 nm de di√¢metro.</li><li><strong>Sorotipos:</strong> Quatro sorotipos antig√™nicamente distintos (DENV-1, DENV-2, DENV-3, DENV-4), o que torna a resposta imune complexa.</li></ul>`,
            medicalImportance: `<ul><li><strong>Impacto Global:</strong> Uma das arboviroses de maior impacto no mundo, end√™mica em mais de 100 pa√≠ses.</li><li><strong>Espectro Cl√≠nico:</strong> Varia de quadros febris leves a formas graves como a Dengue Hemorr√°gica e a S√≠ndrome do Choque da Dengue.</li><li><strong>Fator de Risco:</strong> A infec√ß√£o secund√°ria por um sorotipo diferente aumenta o risco de desenvolver formas graves da doen√ßa.</li></ul>`,
            clinicalPerspective: `<ul><li><strong>Manejo Cl√≠nico:</strong> Focado no suporte h√≠drico e reconhecimento precoce dos sinais de alarme (dor abdominal, sangramentos, etc.).</li><li><strong>Controle Epidemiol√≥gico:</strong> Baseado no combate ao vetor <em>Aedes aegypti</em> e na vigil√¢ncia ativa de casos.</li><li><strong>Preven√ß√£o:</strong> Vacinas j√° est√£o dispon√≠veis e s√£o uma ferramenta importante para o controle em √°reas end√™micas.</li></ul>`
        }
    },
    'Herpes': {
        rawData: `Paciente,Sexo,Idade,Tipo cl√≠nico,Les√µes vesiculares dolorosas,Localiza√ß√£o (oral/genital),Recorr√™ncia,Febre,HIV+,PCR positivo para HSV
1,F,23,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
2,M,31,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
3,F,27,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
4,M,35,HSV-1,Sim,Oral,N√£o,Sim,N√£o,Sim
5,F,29,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
6,M,42,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
7,F,26,HSV-2,Sim,Genital,N√£o,Sim,N√£o,Sim
8,M,38,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
9,F,33,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
10,M,45,HSV-1,Sim,Oral,N√£o,Sim,N√£o,Sim
11,F,21,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
12,M,36,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
13,F,40,HSV-2,Sim,Genital,N√£o,Sim,N√£o,Sim
14,M,28,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
15,F,25,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
16,M,49,HSV-1,Sim,Oral,Sim,Sim,Sim,Sim
17,F,32,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
18,M,53,HSV-1,Sim,Oral,N√£o,Sim,Sim,Sim
19,F,30,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
20,M,41,HSV-1,Sim,Oral,Sim,N√£o,Sim,Sim`,
        info: {
            introduction: `<ul><li><strong>Fam√≠lia:</strong> Herpesviridae</li><li><strong>Subfam√≠lia:</strong> Alphaherpesvirinae</li><li><strong>G√™nero:</strong> Simplexvirus</li><li><strong>Genoma:</strong> DNA de fita dupla, linear.</li><li><strong>Morfologia:</strong> V√≠rus grande, envelopado, com um caps√≠deo icosa√©drico.</li><li><strong>Tipos Principais:</strong> Herpes Simplex Virus 1 (HSV-1), classicamente oral, e Herpes Simplex Virus 2 (HSV-2), classicamente genital.</li></ul>`,
            medicalImportance: `<ul><li><strong>Preval√™ncia:</strong> Infec√ß√µes extremamente comuns e disseminadas globalmente.</li><li><strong>Lat√™ncia e Recorr√™ncia:</strong> Caracteriza-se por establecer infec√ß√£o latente nos g√¢nglios neurais, com reativa√ß√µes peri√≥dicas.</li><li><strong>Complica√ß√µes:</strong> Embora geralmente benignas, podem causar quadros graves como encefalite, ceratite e infec√ß√µes neonatais de alta mortalidade.</li></ul>`,
            clinicalPerspective: `<ul><li><strong>Tratamento:</strong> Antivirais (ex: Aciclovir) reduzem a dura√ß√£o e a gravidade dos surtos, mas n√£o curam a infec√ß√£o.</li><li><strong>Preven√ß√£o:</strong> Focada na educa√ß√£o sobre transmiss√£o (contato direto com les√µes) e pr√°ticas sexuais seguras.</li><li><strong>Popula√ß√µes de Risco:</strong> Pacientes imunocomprometidos podem apresentar quadros at√≠picos, extensos e mais graves.</li></ul>`
        }
    },
    'Hepatite B': {
        rawData: `Paciente,Sexo,Idade,Forma cl√≠nica,Icter√≠cia,Astenia,Dor abdominal,N√°useas,HBsAg,Anti-HBc IgM,Anti-HBc total,HBeAg,Carga viral detect√°vel,ALT elevada
1,M,32,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
2,F,41,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
3,M,55,Cr√¥nica,N√£o,Sim,Sim,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
4,F,27,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
5,M,63,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
6,F,36,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
7,M,44,Cr√¥nica,N√£o,Sim,Sim,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
8,F,50,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
9,M,39,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
10,F,29,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
11,M,58,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
12,F,35,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
13,M,46,Cr√¥nica,N√£o,Sim,Sim,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
14,F,40,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
15,M,60,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
16,F,34,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
17,M,49,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
18,F,38,Cr√¥nica,N√£o,Sim,Sim,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
19,M,54,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
20,F,31,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim`,
        info: {
            introduction: `<ul><li><strong>Fam√≠lia:</strong> Hepadnaviridae</li><li><strong>G√™nero:</strong> Orthohepadnavirus</li><li><strong>Esp√©cie:</strong> V√≠rus da Hepatite B (HBV)</li><li><strong>Genoma:</strong> DNA circular, parcialmente de fita dupla.</li><li><strong>Morfologia:</strong> Part√≠cula viral complexa (Part√≠cula de Dane), com ant√≠genos de superf√≠cie (HBsAg), core (HBcAg) e "e" (HBeAg).</li></ul>`,
            medicalImportance: `<ul><li><strong>Sa√∫de P√∫blica:</strong> Um dos maiores problemas de sa√∫de globais, com milh√µes de portadores cr√¥nicos.</li><li><strong>Doen√ßa Cr√¥nica:</strong> A principal causa de cirrose hep√°tica e carcinoma hepatocelular em todo o mundo.</li><li><strong>Transmiss√£o:</strong> Ocorre por vias parenteral (sangue), sexual e vertical (m√£e-filho).</li></ul>`,
            clinicalPerspective: `<ul><li><strong>Preven√ß√£o:</strong> A vacina√ß√£o √© a medida mais eficaz e segura para prevenir a infec√ß√£o.</li><li><strong>Tratamento:</strong> Para a forma cr√¥nica, visa suprimir a replica√ß√£o viral, reduzir a inflama√ß√£o hep√°tica e prevenir a progress√£o da doen√ßa.</li><li><strong>Diagn√≥stico:</strong> Realizado por meio de marcadores sorol√≥gicos que definem o est√°gio da infec√ß√£o (aguda, cr√¥nica, curada).</li></ul>`
        }
    },
    'Influenza': {
        rawData: `Paciente,Sexo,Idade,Febre,Tosse seca,Odinofagia,Mialgia,Cefaleia,Dispneia,Comorbidade (HAS/DM/Asma),Hospitaliza√ß√£o,RT-PCR positivo
1,F,24,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
2,M,37,Sim,Sim,N√£o,Sim,Sim,N√£o,N√£o,N√£o,Sim
3,F,58,Sim,Sim,Sim,Sim,Sim,Sim,HAS,Sim,Sim
4,M,19,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
5,F,43,Sim,Sim,N√£o,Sim,Sim,N√£o,DM,N√£o,Sim
6,M,62,Sim,Sim,Sim,Sim,Sim,Sim,HAS,Sim,Sim
7,F,29,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
8,M,46,Sim,Sim,Sim,Sim,Sim,N√£o,Asma,N√£o,Sim
9,F,33,Sim,Sim,N√£o,Sim,Sim,N√£o,N√£o,N√£o,Sim
10,M,71,Sim,Sim,Sim,Sim,Sim,Sim,HAS/DM,Sim,Sim
11,F,40,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
12,M,55,Sim,Sim,N√£o,Sim,Sim,Sim,HAS,Sim,Sim
13,F,27,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
14,M,64,Sim,Sim,Sim,Sim,Sim,Sim,HAS,Sim,Sim
15,F,36,Sim,Sim,N√£o,Sim,Sim,N√£o,N√£o,N√£o,Sim
16,M,42,Sim,Sim,Sim,Sim,Sim,N√£o,Asma,N√£o,Sim
17,F,31,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
18,M,68,Sim,Sim,Sim,Sim,Sim,Sim,DM,Sim,Sim
19,F,50,Sim,Sim,N√£o,Sim,Sim,N√£o,HAS,N√£o,Sim
20,M,74,Sim,Sim,Sim,Sim,Sim,Sim,HAS/DM,Sim,Sim`,
        info: {
            introduction: `<ul><li><strong>Fam√≠lia:</strong> Orthomyxoviridae</li><li><strong>G√™nero:</strong> Influenzavirus</li><li><strong>Genoma:</strong> RNA de fita simples, segmentado (8 segmentos).</li><li><strong>Morfologia:</strong> V√≠rus envelopado com duas glicoprote√≠nas de superf√≠cie principais: Hemaglutinina (HA) e Neuraminidase (NA).</li><li><strong>Variabilidade:</strong> A natureza segmentada do genoma permite alta taxa de muta√ß√£o (drift) e rearranjo gen√©tico (shift), causando epidemias e pandemias.</li></ul>`,
            medicalImportance: `<ul><li><strong>Sazonalidade:</strong> Causa epidemias anuais com impacto significativo na sa√∫de p√∫blica e na economia.</li><li><strong>Pandemias:</strong> O rearranjo de genes entre v√≠rus de diferentes esp√©cies pode originar novas cepas pand√™micas com alta virul√™ncia.</li><li><strong>Grupos de Risco:</strong> A infec√ß√£o pode ser grave e fatal em idosos, crian√ßas, gestantes e pessoas com comorbidades.</li></ul>`,
            clinicalPerspective: `<ul><li><strong>Preven√ß√£o:</strong> A vacina√ß√£o anual √© a principal estrat√©gia de controle, atualizada para as cepas circulantes.</li><li><strong>Tratamento:</strong> Antivirais (inibidores da neuraminidase) podem ser usados, principalmente em casos graves ou em grupos de risco.</li><li><strong>Vigil√¢ncia:</strong> A vigil√¢ncia epidemiol√≥gica e virol√≥gica global √© fundamental para monitorar a evolu√ß√£o do v√≠rus.</li></ul>`
        }
    },
    'Candid√≠ase': {
        rawData: `Paciente,Sexo,Idade,Prurido genital,Corrimento branco,Placas esbranqui√ßadas orais,Dispareunia,HIV+,Glicemia elevada,Cultura positiva p/ Candida
1,F,26,Sim,Sim,N√£o,Sim,N√£o,N√£o,Sim
2,F,34,Sim,Sim,N√£o,N√£o,N√£o,Sim,Sim
3,M,41,N√£o,N√£o,Sim,N√£o,Sim,N√£o,Sim
4,F,29,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
5,F,50,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim
6,F,23,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
7,M,38,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
8,F,45,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim
9,F,32,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
10,M,48,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
11,F,27,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
12,F,52,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim
13,F,36,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
14,M,44,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
15,F,28,Sim,Sim,N√£o,Sim,N√£o,N√£o,Sim
16,F,39,Sim,Sim,N√£o,N√£o,N√£o,Sim,Sim
17,M,42,N√£o,N√£o,Sim,N√£o,Sim,N√£o,Sim
18,F,31,Sim,Sim,N√£o,Sim,N√£o,N√£o,Sim
19,F,47,Sim,Sim,N√£o,N√£o,N√£o,Sim,Sim
20,M,55,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim`,
        info: {
            introduction: `<ul><li><strong>Reino:</strong> Fungi</li><li><strong>G√™nero:</strong> Candida</li><li><strong>Esp√©cie Principal:</strong> <em>Candida albicans</em>.</li><li><strong>Morfologia:</strong> Levedura dim√≥rfica, pode existir como blastocon√≠dios (forma comensal) ou hifas/pseudo-hifas (forma invasiva).</li><li><strong>Comensalismo:</strong> Faz parte da microbiota normal da pele, trato gastrointestinal e geniturin√°rio.</li></ul>`,
            medicalImportance: `<ul><li><strong>Infec√ß√£o Oportunista:</strong> Causa doen√ßa quando h√° um desequil√≠brio na microbiota ou imunossupress√£o do hospedeiro.</li><li><strong>Espectro:</strong> Varia de infec√ß√µes superficiais (candid√≠ase oral, vulvovaginal) a infec√ß√µes sist√™micas (candidemia) com alta mortalidade.</li><li><strong>Fatores de Risco:</strong> Diabetes, uso de antibi√≥ticos, corticoides, cateteres e imunodefici√™ncias (ex: HIV/AIDS).</li></ul>`,
            clinicalPerspective: `<ul><li><strong>Diagn√≥stico:</strong> Cl√≠nico, confirmado por exame micol√≥gico direto ou cultura.</li><li><strong>Tratamento:</strong> Antif√∫ngicos t√≥picos ou sist√™micos, dependendo da localiza√ß√£o e gravidade da infec√ß√£o.</li><li><strong>Controle:</strong> Manejo dos fatores de risco √© crucial para prevenir a doen√ßa e suas recorr√™ncias.</li></ul>`
        }
    },
    'Esporotricose': {
        rawData: `Paciente,Sexo,Idade,Profiss√£o/Exposi√ß√£o,Les√£o ulcerada cut√¢nea,Forma linfocut√¢nea,Forma disseminada,Contato com gato,HIV+,Cultura positiva p/ Sporothrix
1,M,45,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
2,F,32,Dona de casa (jardim),Sim,N√£o,N√£o,Sim,N√£o,Sim
3,M,60,Jardineiro,Sim,Sim,N√£o,N√£o,N√£o,Sim
4,F,28,Estudante (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
5,M,54,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
6,F,37,Professora (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
7,M,42,Pedreiro,Sim,Sim,N√£o,N√£o,N√£o,Sim
8,F,47,Feirante (hortali√ßas),Sim,Sim,N√£o,N√£o,N√£o,Sim
9,M,35,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
10,F,29,Dona de casa (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
11,M,62,Aposentado (horta),Sim,Sim,N√£o,N√£o,N√£o,Sim
12,F,41,Veterin√°ria,Sim,N√£o,N√£o,Sim,N√£o,Sim
13,M,56,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
14,F,39,Comerciante (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
15,M,48,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
16,F,44,Dona de casa (jardim),Sim,N√£o,N√£o,Sim,N√£o,Sim
17,M,51,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
18,F,33,Estudante (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
19,M,65,Aposentado (horta),Sim,Sim,N√£o,N√£o,N√£o,Sim
20,M,40,HIV+,Sim,Sim,Sim,N√£o,Sim,Sim`,
        info: {
            introduction: `<ul><li><strong>Reino:</strong> Fungi</li><li><strong>G√™nero:</strong> <em>Sporothrix</em></li><li><strong>Morfologia:</strong> Fungo dim√≥rfico, apresentando-se como mofo no ambiente (25¬∞C) e levedura nos tecidos do hospedeiro (37¬∞C).</li><li><strong>Transmiss√£o:</strong> Inocula√ß√£o traum√°tica na pele a partir de solo, plantas ou mat√©ria org√¢nica contaminada. Recentemente, a transmiss√£o zoon√≥tica por gatos se tornou a principal via no Brasil.</li></ul>`,
            medicalImportance: `<ul><li><strong>Micose Subcut√¢nea:</strong> √â a micose de implanta√ß√£o mais comum na Am√©rica Latina.</li><li><strong>Zoonose Emergente:</strong> A epidemia de esporotricose felina no Brasil transformou o perfil epidemiol√≥gico da doen√ßa, que agora √© um problema de sa√∫de p√∫blica urbana.</li><li><strong>Formas Cl√≠nicas:</strong> A mais comum √© a linfocut√¢nea, mas formas disseminadas podem ocorrer em imunocomprometidos.</li></ul>`,
            clinicalPerspective: `<ul><li><strong>Diagn√≥stico:</strong> Isolamento do fungo em cultura √© o padr√£o-ouro.</li><li><strong>Tratamento:</strong> Itraconazol √© o tratamento de escolha para as formas cut√¢neas. Anfotericina B √© usada em casos graves.</li><li><strong>Sa√∫de √önica:</strong> O controle da epidemia exige uma abordagem integrada entre a sa√∫de humana, animal e ambiental.</li></ul>`
        }
    },
    'Histoplasmose': {
        rawData: `Paciente,Sexo,Idade,Exposi√ß√£o (aves/morcegos),Tosse cr√¥nica,Febre,Perda de peso,Les√µes cut√¢neas,Dispneia,HIV+,Rx t√≥rax (infiltrado/adenopatia),Sorologia positiva,Cultura positiva
1,M,48,Sim,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,Sim,Sim
2,F,35,Sim,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
3,M,52,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
4,F,29,N√£o,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
5,M,60,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
6,F,33,Sim,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
7,M,41,Sim,Sim,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim,Sim
8,F,55,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
9,M,38,N√£o,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
10,F,44,Sim,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,Sim,Sim
11,M,47,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
12,F,32,N√£o,Sim,N√£o,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
13,M,53,Sim,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,Sim,Sim
14,F,39,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
15,M,46,Sim,Sim,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim,Sim
16,F,28,N√£o,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
17,M,50,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
18,F,42,Sim,Sim,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim,Sim
19,M,61,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
20,M,36,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim`,
        info: {
            introduction: `<ul><li><strong>Reino:</strong> Fungi</li><li><strong>G√™nero:</strong> <em>Histoplasma</em></li><li><strong>Esp√©cie:</strong> <em>Histoplasma capsulatum</em>.</li><li><strong>Morfologia:</strong> Fungo dim√≥rfico t√©rmico, encontrado como mofo no solo e levedura nos tecidos.</li><li><strong>Habitat:</strong> Solos ricos em excrementos de aves e morcegos, como cavernas, galinheiros e constru√ß√µes abandonadas.</li><li><strong>Transmiss√£o:</strong> Inala√ß√£o de microcon√≠dios.</li></ul>`,
            medicalImportance: `<ul><li><strong>Micose Sist√™mica:</strong> Uma das micoses end√™micas mais comuns no continente americano.</li><li><strong>Infec√ß√£o Oportunista Grave:</strong> Em pacientes com imunodefici√™ncia celular, como na AIDS, pode causar a forma disseminada progressiva, que √© fatal se n√£o tratada.</li><li><strong>Espectro Cl√≠nico:</strong> A maioria das infec√ß√µes √© assintom√°tica; as formas sintom√°ticas podem ser pulmonares agudas, cr√¥nicas ou disseminadas.</li></ul>`,
            clinicalPerspective: `<ul><li><strong>Diagn√≥stico:</strong> Requer alta suspeita cl√≠nica e √© confirmado por cultura, sorologia ou detec√ß√£o de ant√≠geno.</li><li><strong>Tratamento:</strong> Formas leves podem ser autolimitadas. Formas moderadas a graves requerem tratamento com antif√∫ngicos como Itraconazol ou Anfotericina B.</li><li><strong>Preven√ß√£o:</strong> Evitar a exposi√ß√£o em √°reas de alto risco, especialmente para indiv√≠duos imunocomprometidos.</li></ul>`
        }
    },
    'Pitir√≠ase Versicolor': {
        rawData: `Paciente,Sexo,Idade,Fototipo de pele,M√°culas hipopigmentadas,M√°culas hipercromicas,Descama√ß√£o fina,Prurido leve,Sudorese excessiva,Exame direto positivo ( Malassezia )
1,M,22,III,Sim,N√£o,Sim,Sim,Sim,Sim
2,F,28,II,Sim,Sim,Sim,N√£o,Sim,Sim
3,M,19,IV,Sim,N√£o,Sim,N√£o,Sim,Sim
4,F,34,III,Sim,N√£o,Sim,Sim,Sim,Sim
5,M,25,V,N√£o,Sim,Sim,N√£o,Sim,Sim
6,F,30,II,Sim,N√£o,Sim,Sim,Sim,Sim
7,M,21,III,Sim,N√£o,Sim,N√£o,Sim,Sim
8,F,27,IV,Sim,Sim,Sim,Sim,Sim,Sim
9,M,23,II,Sim,N√£o,Sim,N√£o,Sim,Sim
10,F,29,III,Sim,N√£o,Sim,Sim,N√£o,Sim
11,M,26,IV,Sim,Sim,Sim,N√£o,Sim,Sim
12,F,31,V,N√£o,Sim,Sim,Sim,Sim,Sim
13,M,20,II,Sim,N√£o,Sim,Sim,Sim,Sim
14,F,33,III,Sim,Sim,Sim,N√£o,Sim,Sim
15,M,18,IV,Sim,N√£o,Sim,Sim,Sim,Sim
16,F,36,II,Sim,N√£o,Sim,N√£o,N√£o,Sim
17,M,24,III,Sim,N√£o,Sim,Sim,Sim,Sim
18,F,40,IV,N√£o,Sim,Sim,N√£o,Sim,Sim
19,M,22,II,Sim,N√£o,Sim,Sim,Sim,Sim
20,F,35,III,Sim,Sim,Sim,N√£o,Sim,Sim`,
        info: {
            introduction: `<ul><li><strong>Reino:</strong> Fungi</li><li><strong>G√™nero:</strong> <em>Malassezia</em></li><li><strong>Caracter√≠sticas:</strong> Leveduras lipof√≠licas que fazem parte da microbiota normal da pele humana.</li><li><strong>Patog√™nese:</strong> A doen√ßa ocorre quando a levedura comensal se converte em sua forma filamentosa patog√™nica.</li><li><strong>Fatores Predisponentes:</strong> Calor, umidade, sudorese excessiva e oleosidade da pele.</li></ul>`,
            medicalImportance: `<ul><li><strong>Dermatose Comum:</strong> Uma das micoses superficiais mais frequentes em todo o mundo, especialmente em climas quentes.</li><li><strong>Cl√≠nica:</strong> Caracteriza-se por m√°culas discr√¥micas (hipo ou hiperpigmentadas), geralmente no tronco superior.</li><li><strong>Impacto:</strong> √â uma condi√ß√£o benigna, mas o impacto est√©tico pode ser significativo para o paciente, e as recidivas s√£o comuns.</li></ul>`,
            clinicalPerspective: `<ul><li><strong>Diagn√≥stico:</strong> Geralmente cl√≠nico, podendo ser confirmado por exame micol√≥gico direto (visualiza√ß√£o de hifas e leveduras).</li><li><strong>Tratamento:</strong> T√≥pico na maioria dos casos, com antif√∫ngicos em xampus ou cremes. Antif√∫ngicos orais s√£o reservados para casos extensos ou recorrentes.</li><li><strong>Recorr√™ncia:</strong> A educa√ß√£o do paciente sobre a natureza recorrente da doen√ßa √© importante, pois o fungo √© um habitante normal da pele.</li></ul>`
        }
    }
};

function parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim());
    return lines.slice(1).map(line => {
        const values = line.split(',');
        const obj = {};
        headers.forEach((header, i) => {
            obj[header] = values[i] ? values[i].trim() : '';
        });
        return obj;
    });
}

function analyzeData(parsedData) {
    const analysis = {};
    if (!parsedData || parsedData.length === 0) return analysis;
    const headers = Object.keys(parsedData[0]);
    headers.forEach(header => {
        const lowerHeader = header.toLowerCase();
        if (lowerHeader === 'paciente' || lowerHeader === 'idade' || lowerHeader.includes('profiss√£o') || lowerHeader.includes('fototipo')) return;
        
        const counts = parsedData.reduce((acc, row) => {
            const value = row[header] || 'N/A';
            acc[value] = (acc[value] || 0) + 1;
            return acc;
        }, {});
        analysis[header] = counts;
    });
    return analysis;
}

function updateUI() {
    const steps = document.querySelectorAll('.step-card');
    steps.forEach((step, index) => {
        step.classList.toggle('hidden', index + 1 !== state.currentStep);
    });

    const progressBar = document.getElementById('progressBar');
    const stepIndicator = document.getElementById('step-indicator');
    const totalSteps = steps.length;
    const progress = (state.currentStep / totalSteps) * 100;
    progressBar.style.width = `${progress}%`;
    stepIndicator.textContent = `Passo ${state.currentStep} de ${totalSteps}`;

    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const generateBtn = document.getElementById('generate-btn');

    prevBtn.disabled = state.currentStep === 1;
    nextBtn.classList.toggle('hidden', state.currentStep === totalSteps);
    generateBtn.classList.toggle('hidden', state.currentStep !== totalSteps);

    validateStep();
}

function validateStep() {
    const nextBtn = document.getElementById('next-btn');
    const generateBtn = document.getElementById('generate-btn');
    let isValid = false;

    switch (state.currentStep) {
        case 1:
            isValid = !!state.selectedInfection;
            break;
        case 2:
            isValid = true;
            break;
        case 3:
            const obs = document.getElementById('observations').value;
            const conc = document.getElementById('conclusion').value;
            isValid = obs.trim() !== '' && conc.trim() !== '';
            break;
        case 4:
            const authors = document.getElementById('authors').value;
            isValid = authors.trim() !== '' && !!state.presentation.layout;
            break;
    }
    nextBtn.disabled = !isValid;
    generateBtn.disabled = !isValid;
}

function renderStep1() {
    const list = document.getElementById('infection-list');
    list.innerHTML = '';
    Object.keys(infectionData).forEach(name => {
        const button = document.createElement('button');
        button.className = `p-4 rounded-lg text-center cursor-pointer infection-btn ${state.selectedInfection === name ? 'selected' : ''}`;
        button.textContent = name;
        button.onclick = () => {
            state.selectedInfection = name;
            renderStep1();
            validateStep();
        };
        list.appendChild(button);
    });
}

function renderStep2() {
    const rawData = infectionData[state.selectedInfection].rawData;
    const headers = rawData.split('\n')[0].split(',').map(h => h.trim());
    const parsedData = parseCSV(rawData);

    const tableHead = document.querySelector('#data-table thead');
    const tableBody = document.querySelector('#data-table tbody');
    tableHead.innerHTML = '';
    tableBody.innerHTML = '';

    const trHead = document.createElement('tr');
    headers.forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        th.className = 'p-2';
        trHead.appendChild(th);
    });
    tableHead.appendChild(trHead);

    parsedData.forEach(rowData => {
        const trBody = document.createElement('tr');
        trBody.className = 'border-b border-gray-700 hover:bg-gray-700/50';
        headers.forEach(header => {
            const td = document.createElement('td');
            td.className = 'data-input-cell';
            td.textContent = rowData[header] || '';
            trBody.appendChild(td);
        });
        tableBody.appendChild(trBody);
    });
}

function calculateAndRenderMetrics(variableName) {
    const metricsDisplay = document.getElementById('metrics-display-container');
    metricsDisplay.innerHTML = ''; // Clear previous metrics

    const variableData = state.data.analysis[variableName];
    if (!variableData) {
        metricsDisplay.innerHTML = `<p class="text-gray-400">Dados n√£o dispon√≠veis para esta vari√°vel.</p>`;
        return;
    }

    const total = state.data.total;
    const categories = Object.keys(variableData);

    // Calculate Mode
    let mode = '';
    let maxCount = 0;
    categories.forEach(cat => {
        if (variableData[cat] > maxCount) {
            maxCount = variableData[cat];
            mode = cat;
        }
    });

    let html = `<h3 class="text-2xl font-bold text-cyan-400 mb-6 text-center">${variableName}</h3>`;
    html += `<div class="space-y-4">`;

    // Display Mode
    html += `
        <div class="bg-gray-800 p-4 rounded-lg">
            <p class="text-sm text-gray-400">Tend√™ncia Central (Moda)</p>
            <p class="text-xs text-gray-500 mb-2">O valor que aparece com mais frequ√™ncia.</p>
            <p class="text-xl font-semibold text-white">${mode}</p>
        </div>
    `;

    // Display Frequency Distribution
    html += `<div class="bg-gray-800 p-4 rounded-lg">`;
    html += `<p class="text-sm text-gray-400 mb-3">Distribui√ß√£o de Frequ√™ncia</p>`;
    categories.forEach(cat => {
        const count = variableData[cat];
        const percentage = ((count / total) * 100).toFixed(1);
        html += `
            <div class="mb-3">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-white text-sm">${cat}</span>
                    <span class="text-gray-300 font-mono text-xs">${count} / ${total} (${percentage}%)</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2">
                    <div class="bg-cyan-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                </div>
            </div>
        `;
    });
    html += `</div>`;
    html += `</div>`;

    metricsDisplay.innerHTML = html;
}

function renderStep3() {
    const parsed = parseCSV(infectionData[state.selectedInfection].rawData);
    const analysis = analyzeData(parsed);
    state.data.analysis = analysis;
    state.data.total = parsed.length;

    const buttonsContainer = document.getElementById('variable-buttons');
    buttonsContainer.innerHTML = '';
    
    const variables = Object.keys(analysis);
    variables.forEach((variable, index) => {
        const button = document.createElement('button');
        button.textContent = variable;
        button.dataset.variable = variable;
        button.className = `variable-btn w-full text-left p-3 rounded-md bg-gray-700 hover:bg-gray-600 text-white`;
        if (index === 0) button.classList.add('active');
        buttonsContainer.appendChild(button);
    });

    buttonsContainer.addEventListener('click', (e) => {
        if (e.target && e.target.matches('button.variable-btn')) {
            const variableName = e.target.dataset.variable;
            document.querySelectorAll('.variable-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            calculateAndRenderMetrics(variableName);
        }
    });

    if (variables.length > 0) {
        calculateAndRenderMetrics(variables[0]);
    }
    
    document.getElementById('observations').addEventListener('input', validateStep);
    document.getElementById('conclusion').addEventListener('input', validateStep);
}


function renderStep4() {
    const layouts = {
        'teal': { name: '√Ågua-marinha', class: 'bg-gradient-to-br from-teal-400 to-cyan-600' },
        'amber': { name: 'Dourado', class: 'bg-gradient-to-br from-amber-400 to-orange-600' },
        'indigo': { name: 'Violeta', class: 'bg-gradient-to-br from-indigo-400 to-purple-600' },
        'rose': { name: 'Magenta', class: 'bg-gradient-to-br from-rose-400 to-pink-600' }
    };
    const container = document.getElementById('layout-options');
    container.innerHTML = '';
    
    for (const key in layouts) {
        const layout = layouts[key];
        const button = document.createElement('button');
        button.dataset.layoutKey = key;
        button.innerHTML = `<div class="w-10 h-10 rounded-full ${layout.class} mb-1 shadow-lg pointer-events-none"></div><span class="text-xs text-gray-300 pointer-events-none">${layout.name}</span>`;
        button.className = `flex flex-col items-center p-2 border-2 rounded-lg transition-colors ${state.presentation.layout === key ? 'border-cyan-400' : 'border-transparent'}`;
        button.onclick = () => {
            state.presentation.layout = key;
            container.querySelectorAll('button').forEach(btn => {
                btn.classList.toggle('border-cyan-400', btn.dataset.layoutKey === key);
                btn.classList.toggle('border-transparent', btn.dataset.layoutKey !== key);
            });
            validateStep();
        };
        container.appendChild(button);
    }
    
    document.getElementById('authors').addEventListener('input', (e) => {
        state.presentation.authors = e.target.value;
        validateStep();
    });
    validateStep();
}

function generateMetricsHTML(theme, variablesToShow) {
    const total = state.data.total;
    let metricsHtml = '';

    for (const variable of variablesToShow) {
        const variableData = state.data.analysis[variable];
        if (!variableData) continue;
        const categories = Object.keys(variableData);

        let mode = '';
        let maxCount = 0;
        categories.forEach(cat => {
            if (variableData[cat] > maxCount) {
                maxCount = variableData[cat];
                mode = cat;
            }
        });
        
        let distributionHtml = '';
        categories.forEach(cat => {
             const count = variableData[cat];
             const percentage = ((count / total) * 100).toFixed(1);
             distributionHtml += `
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 1.1em;">
                        <span style="color: ${theme.text};">${cat}</span>
                        <span style="color: ${theme.text}; opacity: 0.8;">${percentage}%</span>
                    </div>
                    <div style="width: 100%; background-color: rgba(0,0,0,0.2); border-radius: 5px; height: 10px;">
                        <div style="background-color: ${theme.secondary}; height: 10px; border-radius: 5px; width: ${percentage}%;"></div>
                    </div>
                </div>
             `;
        });

        metricsHtml += `
            <div style="background-color: rgba(0,0,0,0.2); border-radius: 12px; padding: 20px; text-align: left;">
                <h4 style="margin: 0 0 20px 0; font-size: 1.4em; color: ${theme.text}; text-align: center; font-family: 'Poppins', sans-serif;">${variable}</h4>
                <p style="font-size: 1.1em; opacity: 0.8; margin: 0;">Moda (Mais Frequente):</p>
                <p style="font-size: 1.5em; font-weight: bold; color: ${theme.secondary}; margin: 5px 0 20px 0;">${mode}</p>
                ${distributionHtml}
            </div>
        `;
    }
    return metricsHtml;
}

function generateTextCardSlides(title, icon, text, itemsPerSlide) {
    let slidesHTML = '';
    const items = text.split('\n').filter(item => item.trim() !== '');
    if (items.length === 0) return '';

    const itemChunks = [];
    for (let i = 0; i < items.length; i += itemsPerSlide) {
        itemChunks.push(items.slice(i, i + itemsPerSlide));
    }

    itemChunks.forEach(chunk => {
        const cardHTML = `<div class="info-card"><ul>${chunk.map(item => `<li>${item}</li>`).join('')}</ul></div>`;
        slidesHTML += `<section class="slide text-card-slide"><header></header><div class="slide-content"><h2>${icon} ${title}</h2><div>${cardHTML}</div></div><footer></footer></section>`;
    });
    return slidesHTML;
}


async function generatePresentation() {
    const { selectedInfection, analysis, presentation } = state;
    const info = infectionData[selectedInfection].info;
    
    document.getElementById('generate-btn').textContent = 'Gerando...';
    document.getElementById('generate-btn').disabled = true;

    const colorSchemes = {
        teal: { primary: '#0D7377', secondary: '#4ECDC4', accent: '#F7B801', text: '#F7FFF7', textDark: '#1A535C' },
        amber: { primary: '#B45309', secondary: '#F59E0B', accent: '#65A30D', text: '#FFFBEB', textDark: '#78350F' },
        indigo: { primary: '#312E81', secondary: '#6366F1', accent: '#EC4899', text: '#EEF2FF', textDark: '#3730A3' },
        rose: { primary: '#881337', secondary: '#F43F5E', accent: '#0891B2', text: '#FFF1F2', textDark: '#9F1239' }
    };
    const theme = colorSchemes[presentation.layout];
    
    const icons = {
        introduction: 'üìñ', medicalImportance: '‚öïÔ∏è', data: 'üìä',
        observations: 'üí°', conclusion: 'üìå', perspective: 'üî≠', thanks: 'üôè'
    };

    const variables = Object.keys(state.data.analysis);
    const variableChunks = [];
    for (let i = 0; i < variables.length; i += 2) {
        variableChunks.push(variables.slice(i, i + 2));
    }

    let metricsSlidesHTML = '';
    variableChunks.forEach(chunk => {
        const metricsContentHTML = generateMetricsHTML(theme, chunk);
        metricsSlidesHTML += `<section class="slide"><header></header><div class="slide-content"><h2>${icons.data} An√°lise Descritiva</h2><div class="grid-metrics">${metricsContentHTML}</div></div><footer></footer></section>`;
    });

    const observationsSlidesHTML = generateTextCardSlides('Observa√ß√µes', icons.observations, analysis.observations, 3);
    const conclusionSlidesHTML = generateTextCardSlides('Conclus√£o', icons.conclusion, analysis.conclusion, 3);

    const slidesHTML = `
        <!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><title>Apresenta√ß√£o: ${selectedInfection}</title>
        <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
        <style>
            :root { --p: ${theme.primary}; --s: ${theme.secondary}; --a: ${theme.accent}; --t: ${theme.text}; --td: ${theme.textDark}; }
            body { font-family: 'Lato', sans-serif; background-color: var(--p); color: var(--t); margin: 0; overflow: hidden; }
            .slide { box-sizing: border-box; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px 60px; height: 100vh; width: 100%; position: absolute; top: 0; left: 0; opacity: 0; transform: scale(0.95); visibility: hidden; transition: opacity 0.6s ease, transform 0.6s ease, visibility 0.6s; }
            .slide.active { display: flex; opacity: 1; transform: scale(1); visibility: visible; }
            .slide-content { max-width: 1200px; width: 100%; animation: fadeIn 1s ease-out 0.3s both; }
            header { position: absolute; top: 20px; left: 20px; right: 20px; font-size: 1em; text-align: left; border-bottom: 1px solid var(--s); padding-bottom: 12px; opacity: 0.7; }
            header p { margin: 2px 0; color: var(--t); }
            footer { position: absolute; bottom: 20px; right: 20px; font-size: 1.1em; color: var(--t); opacity: 0.7; }
            h1 { font-family: 'Poppins', sans-serif; font-size: clamp(3.5rem, 8vw, 5.5rem); letter-spacing: -1px; font-weight: 800; color: white; text-shadow: 2px 2px 15px rgba(0,0,0,0.3); margin: 0; }
            h2 { font-family: 'Poppins', sans-serif; font-size: clamp(2.5rem, 4.5vw, 3.5rem); color: white; border-bottom: 3px solid var(--s); padding-bottom: 15px; margin-bottom: 30px; font-weight: 700; display: inline-flex; align-items: center; gap: 20px; }
            h3 { font-family: 'Poppins', sans-serif; font-size: 1.8em; color: var(--s); margin-bottom: 30px; font-weight: 600; }
            ul { list-style: none; padding: 0; text-align: left; max-width: 900px; margin: 0 auto;}
            ul li { font-size: clamp(1.2rem, 2.2vw, 1.5rem); line-height: 1.7; color: #e2e8f0; margin-bottom: 12px; }
            ul li strong { color: var(--s); }
            .grid-metrics { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; width: 100%; }
            @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

            .info-card { background: rgba(0,0,0,0.2); border-radius: 12px; padding: 25px; margin: 0 auto 25px auto; border-left: 6px solid var(--s); text-align: left; max-width: 900px;}
            .info-card ul { margin: 0; }
            .text-card-slide .slide-content { display: flex; flex-direction: column; justify-content: center; height: 100%;}
            .text-card-slide li { font-size: clamp(1.2rem, 2vw, 1.4rem) !important; line-height: 1.6 !important; }

        </style></head><body>
            <div id="slide-container">
                <section class="slide active"><header></header><div class="slide-content"><h3>An√°lise Epidemiol√≥gica de</h3><h1>${selectedInfection}</h1><p style="text-align: center; margin-top: 60px; color: var(--s); font-family: 'Poppins', sans-serif; font-size: 1.3em;"><strong>Respons√°veis:</strong> ${presentation.authors}</p></div><footer></footer></section>
                <section class="slide"><header></header><div class="slide-content"><h2>${icons.introduction} Introdu√ß√£o</h2>${info.introduction}</div><footer></footer></section>
                <section class="slide"><header></header><div class="slide-content"><h2>${icons.medicalImportance} Import√¢ncia M√©dica</h2>${info.medicalImportance}</div><footer></footer></section>
                ${metricsSlidesHTML}
                ${observationsSlidesHTML}
                ${conclusionSlidesHTML}
                <section class="slide"><header></header><div class="slide-content"><h2>${icons.perspective} Perspectivas</h2>${info.clinicalPerspective}</div><footer></footer></section>
                <section class="slide"><header></header><div class="slide-content"><h3>Agradecimentos</h3><h1>${icons.thanks} Obrigado!</h1></div><footer></footer></section>
            </div>
            
            <script>
                let current = 0;
                const slides = document.querySelectorAll('.slide');
                const total = slides.length;
                const headers = document.querySelectorAll('header');
                const footers = document.querySelectorAll('footer');

                const show = (index) => {
                    slides.forEach((s, i) => s.classList.toggle('active', i === index));
                    const slideElement = slides[index];
                    const realIndex = Array.from(slides).indexOf(slideElement) + 1;
                    
                    footers.forEach(f => {
                         const parentSlide = f.closest('.slide');
                         const parentIndex = Array.from(slides).indexOf(parentSlide) + 1;
                         f.textContent = 'Slide ' + parentIndex + ' / ' + total;
                    });
                    headers.forEach(h => h.innerHTML = '<p>Centro Universit√°rio de Jo√£o Pessoa - UNIP√ä</p><p>Mecanismos de Agress√£o, Patol√≥gicos e de Defesa - 2 | Prof. Rodrigo Niskier</p>');
                };
                
                document.addEventListener('keydown', (e) => { 
                    if (e.key === 'ArrowRight') {
                        current = (current + 1) % total;
                        show(current);
                    }
                    if (e.key === 'ArrowLeft') {
                        current = (current - 1 + total) % total;
                        show(current);
                    }
                });
                                
                show(0);
            <\/script>
        </body></html>`;

    const presentationWindow = window.open('', '_blank');
    presentationWindow.document.write(slidesHTML);
    presentationWindow.document.close();
    
    document.getElementById('generate-btn').textContent = 'Gerar Apresenta√ß√£o';
    document.getElementById('generate-btn').disabled = false;
}

// Inicializa√ß√£o e Event Listeners
document.addEventListener('DOMContentLoaded', () => {
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const generateBtn = document.getElementById('generate-btn');

    nextBtn.addEventListener('click', () => {
        if (state.currentStep < 4) {
            state.currentStep++;
            if (state.currentStep === 2) renderStep2();
            if (state.currentStep === 3) { renderStep3(); }
            if (state.currentStep === 4) renderStep4();
            updateUI();
        }
    });

    prevBtn.addEventListener('click', () => {
        if (state.currentStep > 1) { state.currentStep--; updateUI(); }
    });
    
    document.getElementById('observations').addEventListener('input', (e) => { state.analysis.observations = e.target.value; validateStep(); });
    document.getElementById('conclusion').addEventListener('input', (e) => { state.analysis.conclusion = e.target.value; validateStep(); });

    generateBtn.addEventListener('click', () => { if (!generateBtn.disabled) { generatePresentation(); } });

    renderStep1();
    updateUI();
});
</script>
</body>
</html>

